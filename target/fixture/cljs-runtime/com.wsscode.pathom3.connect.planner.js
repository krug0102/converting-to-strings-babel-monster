goog.provide('com.wsscode.pathom3.connect.planner');
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707),new cljs.core.Symbol("cljs.core","pos-int?","cljs.core/pos-int?",-2115888030,null),cljs.core.pos_int_QMARK_);
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id-set","com.wsscode.pathom3.connect.planner/node-id-set",146448050),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","coll-of","cljs.spec.alpha/coll-of",1019430407,null),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707),new cljs.core.Keyword(null,"kind","kind",-717265803),new cljs.core.Symbol("cljs.core","set?","cljs.core/set?",-1176684971,null)),cljs.spec.alpha.every_impl.cljs$core$IFn$_invoke$arity$4(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707),new cljs.core.PersistentArrayMap(null, 5, [new cljs.core.Keyword("cljs.spec.alpha","kind-form","cljs.spec.alpha/kind-form",-1047104697),new cljs.core.Symbol("cljs.core","set?","cljs.core/set?",-1176684971,null),new cljs.core.Keyword("cljs.spec.alpha","cpred","cljs.spec.alpha/cpred",-693471218),(function (G__158170){
return cljs.core.set_QMARK_(G__158170);
}),new cljs.core.Keyword(null,"kind","kind",-717265803),cljs.core.set_QMARK_,new cljs.core.Keyword("cljs.spec.alpha","conform-all","cljs.spec.alpha/conform-all",45201917),true,new cljs.core.Keyword("cljs.spec.alpha","describe","cljs.spec.alpha/describe",1883026911),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","coll-of","cljs.spec.alpha/coll-of",1019430407,null),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707),new cljs.core.Keyword(null,"kind","kind",-717265803),new cljs.core.Symbol("cljs.core","set?","cljs.core/set?",-1176684971,null))], null),null));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","graph","com.wsscode.pathom3.connect.planner/graph",-1915509744),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","keys","cljs.spec.alpha/keys",1109346032,null),new cljs.core.Keyword(null,"req","req",-326448303),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574)], null)),cljs.spec.alpha.map_spec_impl(cljs.core.PersistentHashMap.fromArrays([new cljs.core.Keyword(null,"req-un","req-un",1074571008),new cljs.core.Keyword(null,"opt-un","opt-un",883442496),new cljs.core.Keyword(null,"gfn","gfn",791517474),new cljs.core.Keyword(null,"pred-exprs","pred-exprs",1792271395),new cljs.core.Keyword(null,"keys-pred","keys-pred",858984739),new cljs.core.Keyword(null,"opt-keys","opt-keys",1262688261),new cljs.core.Keyword(null,"req-specs","req-specs",553962313),new cljs.core.Keyword(null,"req","req",-326448303),new cljs.core.Keyword(null,"req-keys","req-keys",514319221),new cljs.core.Keyword(null,"opt-specs","opt-specs",-384905450),new cljs.core.Keyword(null,"pred-forms","pred-forms",172611832),new cljs.core.Keyword(null,"opt","opt",-794706369)],[null,null,null,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [(function (G__158171){
return cljs.core.map_QMARK_(G__158171);
}),(function (G__158171){
return cljs.core.contains_QMARK_(G__158171,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574));
})], null),(function (G__158171){
return ((cljs.core.map_QMARK_(G__158171)) && (cljs.core.contains_QMARK_(G__158171,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574))));
}),cljs.core.PersistentVector.EMPTY,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574)], null),cljs.core.PersistentVector.EMPTY,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.list(new cljs.core.Symbol("cljs.core","fn","cljs.core/fn",-1065745098,null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"%","%",-950237169,null)], null),cljs.core.list(new cljs.core.Symbol("cljs.core","map?","cljs.core/map?",-1390345523,null),new cljs.core.Symbol(null,"%","%",-950237169,null))),cljs.core.list(new cljs.core.Symbol("cljs.core","fn","cljs.core/fn",-1065745098,null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"%","%",-950237169,null)], null),cljs.core.list(new cljs.core.Symbol("cljs.core","contains?","cljs.core/contains?",-976526835,null),new cljs.core.Symbol(null,"%","%",-950237169,null),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574)))], null),null])));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","available-data","com.wsscode.pathom3.connect.planner/available-data",727921292),new cljs.core.Keyword("com.wsscode.pathom3.format.shape-descriptor","shape-descriptor","com.wsscode.pathom3.format.shape-descriptor/shape-descriptor",1733631433),new cljs.core.Keyword("com.wsscode.pathom3.format.shape-descriptor","shape-descriptor","com.wsscode.pathom3.format.shape-descriptor/shape-descriptor",1733631433));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-parents","com.wsscode.pathom3.connect.planner/node-parents",-690861122),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id-set","com.wsscode.pathom3.connect.planner/node-id-set",146448050),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id-set","com.wsscode.pathom3.connect.planner/node-id-set",146448050));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","attr-deps-trail","com.wsscode.pathom3.connect.planner/attr-deps-trail",-81376567),new cljs.core.Keyword("com.wsscode.pathom3.attribute","attributes-set","com.wsscode.pathom3.attribute/attributes-set",-1031622660),new cljs.core.Keyword("com.wsscode.pathom3.attribute","attributes-set","com.wsscode.pathom3.attribute/attributes-set",-1031622660));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","branch-type","com.wsscode.pathom3.connect.planner/branch-type",1641366236),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-and","com.wsscode.pathom3.connect.planner/run-and",-1356844884),"null",new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-or","com.wsscode.pathom3.connect.planner/run-or",-672801891),"null"], null), null),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-and","com.wsscode.pathom3.connect.planner/run-and",-1356844884),null,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-or","com.wsscode.pathom3.connect.planner/run-or",-672801891),null], null), null));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","id-counter","com.wsscode.pathom3.connect.planner/id-counter",1593852285),new cljs.core.Symbol("cljs.core","any?","cljs.core/any?",-2068111842,null),cljs.core.any_QMARK_);
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","foreign-ast","com.wsscode.pathom3.connect.planner/foreign-ast",1579399548),new cljs.core.Keyword("edn-query-language.ast","node","edn-query-language.ast/node",-1614840957),new cljs.core.Keyword("edn-query-language.ast","node","edn-query-language.ast/node",-1614840957));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-type","com.wsscode.pathom3.connect.planner/node-type",-1525481049),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 4, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-resolver","com.wsscode.pathom3.connect.planner/node-resolver",391730247),"null",new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-or","com.wsscode.pathom3.connect.planner/node-or",-1576441526),"null",new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-and","com.wsscode.pathom3.connect.planner/node-and",2027136749),"null",new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-unknown","com.wsscode.pathom3.connect.planner/node-unknown",-1165199202),"null"], null), null),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 4, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-resolver","com.wsscode.pathom3.connect.planner/node-resolver",391730247),null,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-or","com.wsscode.pathom3.connect.planner/node-or",-1576441526),null,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-and","com.wsscode.pathom3.connect.planner/node-and",2027136749),null,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-unknown","com.wsscode.pathom3.connect.planner/node-unknown",-1165199202),null], null), null));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","input","com.wsscode.pathom3.connect.planner/input",1912157524),new cljs.core.Keyword("com.wsscode.pathom3.format.shape-descriptor","shape-descriptor","com.wsscode.pathom3.format.shape-descriptor/shape-descriptor",1733631433),new cljs.core.Keyword("com.wsscode.pathom3.format.shape-descriptor","shape-descriptor","com.wsscode.pathom3.format.shape-descriptor/shape-descriptor",1733631433));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","index-attrs","com.wsscode.pathom3.connect.planner/index-attrs",-2110590142),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Keyword("com.wsscode.pathom3.attribute","attribute","com.wsscode.pathom3.attribute/attribute",1003469786),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id-set","com.wsscode.pathom3.connect.planner/node-id-set",146448050)),cljs.spec.alpha.every_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","tuple","cljs.spec.alpha/tuple",-415901908,null),new cljs.core.Keyword("com.wsscode.pathom3.attribute","attribute","com.wsscode.pathom3.attribute/attribute",1003469786),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id-set","com.wsscode.pathom3.connect.planner/node-id-set",146448050)),cljs.spec.alpha.tuple_impl.cljs$core$IFn$_invoke$arity$2(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.attribute","attribute","com.wsscode.pathom3.attribute/attribute",1003469786),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id-set","com.wsscode.pathom3.connect.planner/node-id-set",146448050)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.attribute","attribute","com.wsscode.pathom3.attribute/attribute",1003469786),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id-set","com.wsscode.pathom3.connect.planner/node-id-set",146448050)], null)),new cljs.core.PersistentArrayMap(null, 7, [new cljs.core.Keyword(null,"into","into",-150836029),cljs.core.PersistentArrayMap.EMPTY,new cljs.core.Keyword("cljs.spec.alpha","kind-form","cljs.spec.alpha/kind-form",-1047104697),new cljs.core.Symbol("cljs.core","map?","cljs.core/map?",-1390345523,null),new cljs.core.Keyword("cljs.spec.alpha","cpred","cljs.spec.alpha/cpred",-693471218),(function (G__158173){
return cljs.core.map_QMARK_(G__158173);
}),new cljs.core.Keyword(null,"kind","kind",-717265803),cljs.core.map_QMARK_,new cljs.core.Keyword("cljs.spec.alpha","kfn","cljs.spec.alpha/kfn",672643897),(function (i__11949__auto__,v__11950__auto__){
return cljs.core.nth.cljs$core$IFn$_invoke$arity$2(v__11950__auto__,(0));
}),new cljs.core.Keyword("cljs.spec.alpha","conform-all","cljs.spec.alpha/conform-all",45201917),true,new cljs.core.Keyword("cljs.spec.alpha","describe","cljs.spec.alpha/describe",1883026911),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Keyword("com.wsscode.pathom3.attribute","attribute","com.wsscode.pathom3.attribute/attribute",1003469786),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id-set","com.wsscode.pathom3.connect.planner/node-id-set",146448050))], null),null));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","index-resolver->nodes","com.wsscode.pathom3.connect.planner/index-resolver->nodes",-1876314434),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id-set","com.wsscode.pathom3.connect.planner/node-id-set",146448050)),cljs.spec.alpha.every_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","tuple","cljs.spec.alpha/tuple",-415901908,null),new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id-set","com.wsscode.pathom3.connect.planner/node-id-set",146448050)),cljs.spec.alpha.tuple_impl.cljs$core$IFn$_invoke$arity$2(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id-set","com.wsscode.pathom3.connect.planner/node-id-set",146448050)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id-set","com.wsscode.pathom3.connect.planner/node-id-set",146448050)], null)),new cljs.core.PersistentArrayMap(null, 7, [new cljs.core.Keyword(null,"into","into",-150836029),cljs.core.PersistentArrayMap.EMPTY,new cljs.core.Keyword("cljs.spec.alpha","kind-form","cljs.spec.alpha/kind-form",-1047104697),new cljs.core.Symbol("cljs.core","map?","cljs.core/map?",-1390345523,null),new cljs.core.Keyword("cljs.spec.alpha","cpred","cljs.spec.alpha/cpred",-693471218),(function (G__158174){
return cljs.core.map_QMARK_(G__158174);
}),new cljs.core.Keyword(null,"kind","kind",-717265803),cljs.core.map_QMARK_,new cljs.core.Keyword("cljs.spec.alpha","kfn","cljs.spec.alpha/kfn",672643897),(function (i__11949__auto__,v__11950__auto__){
return cljs.core.nth.cljs$core$IFn$_invoke$arity$2(v__11950__auto__,(0));
}),new cljs.core.Keyword("cljs.spec.alpha","conform-all","cljs.spec.alpha/conform-all",45201917),true,new cljs.core.Keyword("cljs.spec.alpha","describe","cljs.spec.alpha/describe",1883026911),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id-set","com.wsscode.pathom3.connect.planner/node-id-set",146448050))], null),null));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-depth","com.wsscode.pathom3.connect.planner/node-depth",-1056073078),new cljs.core.Symbol("cljs.core","nat-int?","cljs.core/nat-int?",-164364171,null),cljs.core.nat_int_QMARK_);
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-branch-depth","com.wsscode.pathom3.connect.planner/node-branch-depth",-702915247),new cljs.core.Symbol("cljs.core","nat-int?","cljs.core/nat-int?",-164364171,null),cljs.core.nat_int_QMARK_);
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-chain-depth","com.wsscode.pathom3.connect.planner/node-chain-depth",-1372426841),new cljs.core.Symbol("cljs.core","nat-int?","cljs.core/nat-int?",-164364171,null),cljs.core.nat_int_QMARK_);
com.wsscode.pathom3.connect.planner.ignore_nils = (function com$wsscode$pathom3$connect$planner$ignore_nils(m){
return cljs.core.into.cljs$core$IFn$_invoke$arity$3(cljs.core.PersistentArrayMap.EMPTY,cljs.core.remove.cljs$core$IFn$_invoke$arity$1((function (p__158177){
var vec__158178 = p__158177;
var _ = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158178,(0),null);
var v = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158178,(1),null);
return (v == null);
})),m);
});
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node","com.wsscode.pathom3.connect.planner/node",325156565),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","and","cljs.spec.alpha/and",-2060279705,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","conformer","cljs.spec.alpha/conformer",2140085535,null),new cljs.core.Symbol("com.wsscode.pathom3.connect.planner","ignore-nils","com.wsscode.pathom3.connect.planner/ignore-nils",-2044194730,null)),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","keys","cljs.spec.alpha/keys",1109346032,null),new cljs.core.Keyword(null,"opt","opt",-794706369),new cljs.core.PersistentVector(null, 5, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-next","com.wsscode.pathom3.connect.planner/run-next",285457140),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-parents","com.wsscode.pathom3.connect.planner/node-parents",-690861122),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","expects","com.wsscode.pathom3.connect.planner/expects",2018136040),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","input","com.wsscode.pathom3.connect.planner/input",1912157524)], null))),cljs.spec.alpha.and_spec_impl(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","conformer","cljs.spec.alpha/conformer",2140085535,null),new cljs.core.Symbol("com.wsscode.pathom3.connect.planner","ignore-nils","com.wsscode.pathom3.connect.planner/ignore-nils",-2044194730,null)),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","keys","cljs.spec.alpha/keys",1109346032,null),new cljs.core.Keyword(null,"opt","opt",-794706369),new cljs.core.PersistentVector(null, 5, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-next","com.wsscode.pathom3.connect.planner/run-next",285457140),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-parents","com.wsscode.pathom3.connect.planner/node-parents",-690861122),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","expects","com.wsscode.pathom3.connect.planner/expects",2018136040),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","input","com.wsscode.pathom3.connect.planner/input",1912157524)], null))], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","conformer","cljs.spec.alpha/conformer",2140085535,null),new cljs.core.Symbol("com.wsscode.pathom3.connect.planner","ignore-nils","com.wsscode.pathom3.connect.planner/ignore-nils",-2044194730,null)),com.wsscode.pathom3.connect.planner.ignore_nils,null,true),cljs.spec.alpha.map_spec_impl(cljs.core.PersistentHashMap.fromArrays([new cljs.core.Keyword(null,"req-un","req-un",1074571008),new cljs.core.Keyword(null,"opt-un","opt-un",883442496),new cljs.core.Keyword(null,"gfn","gfn",791517474),new cljs.core.Keyword(null,"pred-exprs","pred-exprs",1792271395),new cljs.core.Keyword(null,"keys-pred","keys-pred",858984739),new cljs.core.Keyword(null,"opt-keys","opt-keys",1262688261),new cljs.core.Keyword(null,"req-specs","req-specs",553962313),new cljs.core.Keyword(null,"req","req",-326448303),new cljs.core.Keyword(null,"req-keys","req-keys",514319221),new cljs.core.Keyword(null,"opt-specs","opt-specs",-384905450),new cljs.core.Keyword(null,"pred-forms","pred-forms",172611832),new cljs.core.Keyword(null,"opt","opt",-794706369)],[null,null,null,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [(function (G__158184){
return cljs.core.map_QMARK_(G__158184);
})], null),(function (G__158184){
return cljs.core.map_QMARK_(G__158184);
}),new cljs.core.PersistentVector(null, 5, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-next","com.wsscode.pathom3.connect.planner/run-next",285457140),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-parents","com.wsscode.pathom3.connect.planner/node-parents",-690861122),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","expects","com.wsscode.pathom3.connect.planner/expects",2018136040),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","input","com.wsscode.pathom3.connect.planner/input",1912157524)], null),cljs.core.PersistentVector.EMPTY,null,cljs.core.PersistentVector.EMPTY,new cljs.core.PersistentVector(null, 5, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-next","com.wsscode.pathom3.connect.planner/run-next",285457140),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-parents","com.wsscode.pathom3.connect.planner/node-parents",-690861122),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","expects","com.wsscode.pathom3.connect.planner/expects",2018136040),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","input","com.wsscode.pathom3.connect.planner/input",1912157524)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.list(new cljs.core.Symbol("cljs.core","fn","cljs.core/fn",-1065745098,null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"%","%",-950237169,null)], null),cljs.core.list(new cljs.core.Symbol("cljs.core","map?","cljs.core/map?",-1390345523,null),new cljs.core.Symbol(null,"%","%",-950237169,null)))], null),new cljs.core.PersistentVector(null, 5, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-next","com.wsscode.pathom3.connect.planner/run-next",285457140),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-parents","com.wsscode.pathom3.connect.planner/node-parents",-690861122),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","expects","com.wsscode.pathom3.connect.planner/expects",2018136040),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","input","com.wsscode.pathom3.connect.planner/input",1912157524)], null)]))], null),null));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node","com.wsscode.pathom3.connect.planner/node",325156565)),cljs.spec.alpha.every_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","tuple","cljs.spec.alpha/tuple",-415901908,null),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node","com.wsscode.pathom3.connect.planner/node",325156565)),cljs.spec.alpha.tuple_impl.cljs$core$IFn$_invoke$arity$2(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node","com.wsscode.pathom3.connect.planner/node",325156565)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node","com.wsscode.pathom3.connect.planner/node",325156565)], null)),new cljs.core.PersistentArrayMap(null, 7, [new cljs.core.Keyword(null,"into","into",-150836029),cljs.core.PersistentArrayMap.EMPTY,new cljs.core.Keyword("cljs.spec.alpha","kind-form","cljs.spec.alpha/kind-form",-1047104697),new cljs.core.Symbol("cljs.core","map?","cljs.core/map?",-1390345523,null),new cljs.core.Keyword("cljs.spec.alpha","cpred","cljs.spec.alpha/cpred",-693471218),(function (G__158192){
return cljs.core.map_QMARK_(G__158192);
}),new cljs.core.Keyword(null,"kind","kind",-717265803),cljs.core.map_QMARK_,new cljs.core.Keyword("cljs.spec.alpha","kfn","cljs.spec.alpha/kfn",672643897),(function (i__11949__auto__,v__11950__auto__){
return cljs.core.nth.cljs$core$IFn$_invoke$arity$2(v__11950__auto__,(0));
}),new cljs.core.Keyword("cljs.spec.alpha","conform-all","cljs.spec.alpha/conform-all",45201917),true,new cljs.core.Keyword("cljs.spec.alpha","describe","cljs.spec.alpha/describe",1883026911),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node","com.wsscode.pathom3.connect.planner/node",325156565))], null),null));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","params","com.wsscode.pathom3.connect.planner/params",1545394210),new cljs.core.Symbol("cljs.core","map?","cljs.core/map?",-1390345523,null),cljs.core.map_QMARK_);
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","expects","com.wsscode.pathom3.connect.planner/expects",2018136040),new cljs.core.Keyword("com.wsscode.pathom3.format.shape-descriptor","shape-descriptor","com.wsscode.pathom3.format.shape-descriptor/shape-descriptor",1733631433),new cljs.core.Keyword("com.wsscode.pathom3.format.shape-descriptor","shape-descriptor","com.wsscode.pathom3.format.shape-descriptor/shape-descriptor",1733631433));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-and","com.wsscode.pathom3.connect.planner/run-and",-1356844884),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id-set","com.wsscode.pathom3.connect.planner/node-id-set",146448050),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id-set","com.wsscode.pathom3.connect.planner/node-id-set",146448050));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-or","com.wsscode.pathom3.connect.planner/run-or",-672801891),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id-set","com.wsscode.pathom3.connect.planner/node-id-set",146448050),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id-set","com.wsscode.pathom3.connect.planner/node-id-set",146448050));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-next","com.wsscode.pathom3.connect.planner/run-next",285457140),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","source-for-attrs","com.wsscode.pathom3.connect.planner/source-for-attrs",-82657270),new cljs.core.Keyword("com.wsscode.pathom3.attribute","attributes-set","com.wsscode.pathom3.attribute/attributes-set",-1031622660),new cljs.core.Keyword("com.wsscode.pathom3.attribute","attributes-set","com.wsscode.pathom3.attribute/attributes-set",-1031622660));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","source-sym","com.wsscode.pathom3.connect.planner/source-sym",-706962767),new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049),new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","unreachable-paths","com.wsscode.pathom3.connect.planner/unreachable-paths",614064297),new cljs.core.Keyword("com.wsscode.pathom3.format.shape-descriptor","shape-descriptor","com.wsscode.pathom3.format.shape-descriptor/shape-descriptor",1733631433),new cljs.core.Keyword("com.wsscode.pathom3.format.shape-descriptor","shape-descriptor","com.wsscode.pathom3.format.shape-descriptor/shape-descriptor",1733631433));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","warn","com.wsscode.pathom3.connect.planner/warn",1381461377),new cljs.core.Symbol("cljs.core","string?","cljs.core/string?",-2072921719,null),cljs.core.string_QMARK_);
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","warnings","com.wsscode.pathom3.connect.planner/warnings",149755478),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","coll-of","cljs.spec.alpha/coll-of",1019430407,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","keys","cljs.spec.alpha/keys",1109346032,null),new cljs.core.Keyword(null,"req","req",-326448303),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","warn","com.wsscode.pathom3.connect.planner/warn",1381461377)], null))),cljs.spec.alpha.every_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("s","keys","s/keys",-1586011188,null),new cljs.core.Keyword(null,"req","req",-326448303),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","warn","com.wsscode.pathom3.connect.planner/warn",1381461377)], null)),cljs.spec.alpha.map_spec_impl(cljs.core.PersistentHashMap.fromArrays([new cljs.core.Keyword(null,"req-un","req-un",1074571008),new cljs.core.Keyword(null,"opt-un","opt-un",883442496),new cljs.core.Keyword(null,"gfn","gfn",791517474),new cljs.core.Keyword(null,"pred-exprs","pred-exprs",1792271395),new cljs.core.Keyword(null,"keys-pred","keys-pred",858984739),new cljs.core.Keyword(null,"opt-keys","opt-keys",1262688261),new cljs.core.Keyword(null,"req-specs","req-specs",553962313),new cljs.core.Keyword(null,"req","req",-326448303),new cljs.core.Keyword(null,"req-keys","req-keys",514319221),new cljs.core.Keyword(null,"opt-specs","opt-specs",-384905450),new cljs.core.Keyword(null,"pred-forms","pred-forms",172611832),new cljs.core.Keyword(null,"opt","opt",-794706369)],[null,null,null,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [(function (G__158194){
return cljs.core.map_QMARK_(G__158194);
}),(function (G__158194){
return cljs.core.contains_QMARK_(G__158194,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","warn","com.wsscode.pathom3.connect.planner/warn",1381461377));
})], null),(function (G__158194){
return ((cljs.core.map_QMARK_(G__158194)) && (cljs.core.contains_QMARK_(G__158194,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","warn","com.wsscode.pathom3.connect.planner/warn",1381461377))));
}),cljs.core.PersistentVector.EMPTY,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","warn","com.wsscode.pathom3.connect.planner/warn",1381461377)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","warn","com.wsscode.pathom3.connect.planner/warn",1381461377)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","warn","com.wsscode.pathom3.connect.planner/warn",1381461377)], null),cljs.core.PersistentVector.EMPTY,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.list(new cljs.core.Symbol("cljs.core","fn","cljs.core/fn",-1065745098,null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"%","%",-950237169,null)], null),cljs.core.list(new cljs.core.Symbol("cljs.core","map?","cljs.core/map?",-1390345523,null),new cljs.core.Symbol(null,"%","%",-950237169,null))),cljs.core.list(new cljs.core.Symbol("cljs.core","fn","cljs.core/fn",-1065745098,null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"%","%",-950237169,null)], null),cljs.core.list(new cljs.core.Symbol("cljs.core","contains?","cljs.core/contains?",-976526835,null),new cljs.core.Symbol(null,"%","%",-950237169,null),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","warn","com.wsscode.pathom3.connect.planner/warn",1381461377)))], null),null])),new cljs.core.PersistentArrayMap(null, 4, [new cljs.core.Keyword("cljs.spec.alpha","kind-form","cljs.spec.alpha/kind-form",-1047104697),null,new cljs.core.Keyword("cljs.spec.alpha","cpred","cljs.spec.alpha/cpred",-693471218),(function (G__158193){
return cljs.core.coll_QMARK_(G__158193);
}),new cljs.core.Keyword("cljs.spec.alpha","conform-all","cljs.spec.alpha/conform-all",45201917),true,new cljs.core.Keyword("cljs.spec.alpha","describe","cljs.spec.alpha/describe",1883026911),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","coll-of","cljs.spec.alpha/coll-of",1019430407,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","keys","cljs.spec.alpha/keys",1109346032,null),new cljs.core.Keyword(null,"req","req",-326448303),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","warn","com.wsscode.pathom3.connect.planner/warn",1381461377)], null)))], null),null));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","conflict-params","com.wsscode.pathom3.connect.planner/conflict-params",58266122),new cljs.core.Keyword("com.wsscode.pathom3.attribute","attributes-set","com.wsscode.pathom3.attribute/attributes-set",-1031622660),new cljs.core.Keyword("com.wsscode.pathom3.attribute","attributes-set","com.wsscode.pathom3.attribute/attributes-set",-1031622660));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","index-ast","com.wsscode.pathom3.connect.planner/index-ast",905845713),new cljs.core.Keyword("com.wsscode.pathom3.format.eql","prop->ast","com.wsscode.pathom3.format.eql/prop->ast",-87545218),new cljs.core.Keyword("com.wsscode.pathom3.format.eql","prop->ast","com.wsscode.pathom3.format.eql/prop->ast",-87545218));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","mutations","com.wsscode.pathom3.connect.planner/mutations",-1571107042),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","coll-of","cljs.spec.alpha/coll-of",1019430407,null),new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049),new cljs.core.Keyword(null,"kind","kind",-717265803),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null)),cljs.spec.alpha.every_impl.cljs$core$IFn$_invoke$arity$4(new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049),new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049),new cljs.core.PersistentArrayMap(null, 5, [new cljs.core.Keyword("cljs.spec.alpha","kind-form","cljs.spec.alpha/kind-form",-1047104697),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null),new cljs.core.Keyword("cljs.spec.alpha","cpred","cljs.spec.alpha/cpred",-693471218),(function (G__158196){
return cljs.core.vector_QMARK_(G__158196);
}),new cljs.core.Keyword(null,"kind","kind",-717265803),cljs.core.vector_QMARK_,new cljs.core.Keyword("cljs.spec.alpha","conform-all","cljs.spec.alpha/conform-all",45201917),true,new cljs.core.Keyword("cljs.spec.alpha","describe","cljs.spec.alpha/describe",1883026911),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","coll-of","cljs.spec.alpha/coll-of",1019430407,null),new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049),new cljs.core.Keyword(null,"kind","kind",-717265803),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null))], null),null));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nested-process","com.wsscode.pathom3.connect.planner/nested-process",-35632382),new cljs.core.Keyword("com.wsscode.pathom3.attribute","attributes-set","com.wsscode.pathom3.attribute/attributes-set",-1031622660),new cljs.core.Keyword("com.wsscode.pathom3.attribute","attributes-set","com.wsscode.pathom3.attribute/attributes-set",-1031622660));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","placeholders","com.wsscode.pathom3.connect.planner/placeholders",-1690563362),new cljs.core.Keyword("com.wsscode.pathom3.attribute","attributes-set","com.wsscode.pathom3.attribute/attributes-set",-1031622660),new cljs.core.Keyword("com.wsscode.pathom3.attribute","attributes-set","com.wsscode.pathom3.attribute/attributes-set",-1031622660));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","idents","com.wsscode.pathom3.connect.planner/idents",-1156950100),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","coll-of","cljs.spec.alpha/coll-of",1019430407,null),new cljs.core.Keyword("edn-query-language.core","ident","edn-query-language.core/ident",419196228),new cljs.core.Keyword(null,"kind","kind",-717265803),new cljs.core.Symbol("cljs.core","set?","cljs.core/set?",-1176684971,null)),cljs.spec.alpha.every_impl.cljs$core$IFn$_invoke$arity$4(new cljs.core.Keyword("edn-query-language.core","ident","edn-query-language.core/ident",419196228),new cljs.core.Keyword("edn-query-language.core","ident","edn-query-language.core/ident",419196228),new cljs.core.PersistentArrayMap(null, 5, [new cljs.core.Keyword("cljs.spec.alpha","kind-form","cljs.spec.alpha/kind-form",-1047104697),new cljs.core.Symbol("cljs.core","set?","cljs.core/set?",-1176684971,null),new cljs.core.Keyword("cljs.spec.alpha","cpred","cljs.spec.alpha/cpred",-693471218),(function (G__158197){
return cljs.core.set_QMARK_(G__158197);
}),new cljs.core.Keyword(null,"kind","kind",-717265803),cljs.core.set_QMARK_,new cljs.core.Keyword("cljs.spec.alpha","conform-all","cljs.spec.alpha/conform-all",45201917),true,new cljs.core.Keyword("cljs.spec.alpha","describe","cljs.spec.alpha/describe",1883026911),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","coll-of","cljs.spec.alpha/coll-of",1019430407,null),new cljs.core.Keyword("edn-query-language.core","ident","edn-query-language.core/ident",419196228),new cljs.core.Keyword(null,"kind","kind",-717265803),new cljs.core.Symbol("cljs.core","set?","cljs.core/set?",-1176684971,null))], null),null));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","optimize-graph?","com.wsscode.pathom3.connect.planner/optimize-graph?",95148922),new cljs.core.Symbol("cljs.core","boolean?","cljs.core/boolean?",1400713761,null),cljs.core.boolean_QMARK_);
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","plan-cache*","com.wsscode.pathom3.connect.planner/plan-cache*",-982885642),new cljs.core.Symbol("com.wsscode.misc.refs","atom?","com.wsscode.misc.refs/atom?",-53238677,null),com.wsscode.misc.refs.atom_QMARK_);
cljs.spec.alpha.def_impl(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshots*","com.wsscode.pathom3.connect.planner/snapshots*",-1855095128),new cljs.core.Symbol("com.wsscode.misc.refs","atom?","com.wsscode.misc.refs/atom?",-53238677,null),com.wsscode.misc.refs.atom_QMARK_);





/**
 * Return the next node ID in the system, its an incremental number
 */
com.wsscode.pathom3.connect.planner.next_node_id = (function com$wsscode$pathom3$connect$planner$next_node_id(p__158198){
var map__158199 = p__158198;
var map__158199__$1 = cljs.core.__destructure_map(map__158199);
var id_counter = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158199__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","id-counter","com.wsscode.pathom3.connect.planner/id-counter",1593852285));
return cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$2(id_counter,cljs.core.inc);
});
com.wsscode.pathom3.connect.planner.new_node = (function com$wsscode$pathom3$connect$planner$new_node(env,node_data){
return cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(node_data,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707),com.wsscode.pathom3.connect.planner.next_node_id(env));
});
com.wsscode.pathom3.connect.planner.get_node = (function com$wsscode$pathom3$connect$planner$get_node(var_args){
var G__158201 = arguments.length;
switch (G__158201) {
case 2:
return com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2((arguments[(0)]),(arguments[(1)]));

break;
case 3:
return com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$3((arguments[(0)]),(arguments[(1)]),(arguments[(2)]));

break;
default:
throw (new Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join('')));

}
});

(com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2 = (function (graph,node_id){
return cljs.core.get_in.cljs$core$IFn$_invoke$arity$2(graph,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574),node_id], null));
}));

(com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$3 = (function (graph,node_id,k){
return cljs.core.get_in.cljs$core$IFn$_invoke$arity$2(graph,new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574),node_id,k], null));
}));

(com.wsscode.pathom3.connect.planner.get_node.cljs$lang$maxFixedArity = 3);

/**
 * Get the node plus the resolver config, when the node has an op-name. If node is
 *   not a resolver not it returns nil.
 */
com.wsscode.pathom3.connect.planner.node_with_resolver_config = (function com$wsscode$pathom3$connect$planner$node_with_resolver_config(graph,env,node_id){
var node = com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,node_id);
var temp__5751__auto__ = (function (){var G__158202 = node;
var G__158202__$1 = (((G__158202 == null))?null:new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049).cljs$core$IFn$_invoke$arity$1(G__158202));
if((G__158202__$1 == null)){
return null;
} else {
return com.wsscode.pathom3.connect.indexes.resolver_config(env,G__158202__$1);
}
})();
if(cljs.core.truth_(temp__5751__auto__)){
var config = temp__5751__auto__;
return cljs.core.merge.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([node,config], 0));
} else {
return null;
}
});
/**
 * Set attribute k about node-id. Only assoc when node exists, otherwise its a noop.
 */
com.wsscode.pathom3.connect.planner.assoc_node = (function com$wsscode$pathom3$connect$planner$assoc_node(graph,node_id,k,v){
if(cljs.core.truth_(com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,node_id))){
return cljs.core.assoc_in(graph,new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574),node_id,k], null),v);
} else {
return graph;
}
});
/**
 * Update a given node in a graph, like Clojure native update.
 */
com.wsscode.pathom3.connect.planner.update_node = (function com$wsscode$pathom3$connect$planner$update_node(var_args){
var G__158212 = arguments.length;
switch (G__158212) {
case 4:
return com.wsscode.pathom3.connect.planner.update_node.cljs$core$IFn$_invoke$arity$4((arguments[(0)]),(arguments[(1)]),(arguments[(2)]),(arguments[(3)]));

break;
case 5:
return com.wsscode.pathom3.connect.planner.update_node.cljs$core$IFn$_invoke$arity$5((arguments[(0)]),(arguments[(1)]),(arguments[(2)]),(arguments[(3)]),(arguments[(4)]));

break;
case 6:
return com.wsscode.pathom3.connect.planner.update_node.cljs$core$IFn$_invoke$arity$6((arguments[(0)]),(arguments[(1)]),(arguments[(2)]),(arguments[(3)]),(arguments[(4)]),(arguments[(5)]));

break;
case 7:
return com.wsscode.pathom3.connect.planner.update_node.cljs$core$IFn$_invoke$arity$7((arguments[(0)]),(arguments[(1)]),(arguments[(2)]),(arguments[(3)]),(arguments[(4)]),(arguments[(5)]),(arguments[(6)]));

break;
default:
var args_arr__4850__auto__ = [];
var len__4829__auto___158471 = arguments.length;
var i__4830__auto___158472 = (0);
while(true){
if((i__4830__auto___158472 < len__4829__auto___158471)){
args_arr__4850__auto__.push((arguments[i__4830__auto___158472]));

var G__158473 = (i__4830__auto___158472 + (1));
i__4830__auto___158472 = G__158473;
continue;
} else {
}
break;
}

var argseq__4851__auto__ = (new cljs.core.IndexedSeq(args_arr__4850__auto__.slice((7)),(0),null));
return com.wsscode.pathom3.connect.planner.update_node.cljs$core$IFn$_invoke$arity$variadic((arguments[(0)]),(arguments[(1)]),(arguments[(2)]),(arguments[(3)]),(arguments[(4)]),(arguments[(5)]),(arguments[(6)]),argseq__4851__auto__);

}
});

(com.wsscode.pathom3.connect.planner.update_node.cljs$core$IFn$_invoke$arity$4 = (function (graph,node_id,k,f){
if(cljs.core.truth_(com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,node_id))){
return cljs.core.update_in.cljs$core$IFn$_invoke$arity$3(graph,(function (){var G__158213 = new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574),node_id], null);
if(cljs.core.truth_(k)){
return cljs.core.conj.cljs$core$IFn$_invoke$arity$2(G__158213,k);
} else {
return G__158213;
}
})(),f);
} else {
return graph;
}
}));

(com.wsscode.pathom3.connect.planner.update_node.cljs$core$IFn$_invoke$arity$5 = (function (graph,node_id,k,f,v){
if(cljs.core.truth_(com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,node_id))){
return cljs.core.update_in.cljs$core$IFn$_invoke$arity$4(graph,(function (){var G__158214 = new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574),node_id], null);
if(cljs.core.truth_(k)){
return cljs.core.conj.cljs$core$IFn$_invoke$arity$2(G__158214,k);
} else {
return G__158214;
}
})(),f,v);
} else {
return graph;
}
}));

(com.wsscode.pathom3.connect.planner.update_node.cljs$core$IFn$_invoke$arity$6 = (function (graph,node_id,k,f,v,v2){
if(cljs.core.truth_(com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,node_id))){
return cljs.core.update_in.cljs$core$IFn$_invoke$arity$5(graph,(function (){var G__158219 = new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574),node_id], null);
if(cljs.core.truth_(k)){
return cljs.core.conj.cljs$core$IFn$_invoke$arity$2(G__158219,k);
} else {
return G__158219;
}
})(),f,v,v2);
} else {
return graph;
}
}));

(com.wsscode.pathom3.connect.planner.update_node.cljs$core$IFn$_invoke$arity$7 = (function (graph,node_id,k,f,v,v2,v3){
if(cljs.core.truth_(com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,node_id))){
return cljs.core.update_in.cljs$core$IFn$_invoke$arity$6(graph,(function (){var G__158221 = new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574),node_id], null);
if(cljs.core.truth_(k)){
return cljs.core.conj.cljs$core$IFn$_invoke$arity$2(G__158221,k);
} else {
return G__158221;
}
})(),f,v,v2,v3);
} else {
return graph;
}
}));

(com.wsscode.pathom3.connect.planner.update_node.cljs$core$IFn$_invoke$arity$variadic = (function (graph,node_id,k,f,v,v2,v3,args){
if(cljs.core.truth_(com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,node_id))){
return cljs.core.apply.cljs$core$IFn$_invoke$arity$variadic(cljs.core.update_in,graph,(function (){var G__158222 = new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574),node_id], null);
if(cljs.core.truth_(k)){
return cljs.core.conj.cljs$core$IFn$_invoke$arity$2(G__158222,k);
} else {
return G__158222;
}
})(),f,v,cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([v2,v3,args], 0));
} else {
return graph;
}
}));

/** @this {Function} */
(com.wsscode.pathom3.connect.planner.update_node.cljs$lang$applyTo = (function (seq158204){
var G__158205 = cljs.core.first(seq158204);
var seq158204__$1 = cljs.core.next(seq158204);
var G__158206 = cljs.core.first(seq158204__$1);
var seq158204__$2 = cljs.core.next(seq158204__$1);
var G__158207 = cljs.core.first(seq158204__$2);
var seq158204__$3 = cljs.core.next(seq158204__$2);
var G__158208 = cljs.core.first(seq158204__$3);
var seq158204__$4 = cljs.core.next(seq158204__$3);
var G__158209 = cljs.core.first(seq158204__$4);
var seq158204__$5 = cljs.core.next(seq158204__$4);
var G__158210 = cljs.core.first(seq158204__$5);
var seq158204__$6 = cljs.core.next(seq158204__$5);
var G__158211 = cljs.core.first(seq158204__$6);
var seq158204__$7 = cljs.core.next(seq158204__$6);
var self__4816__auto__ = this;
return self__4816__auto__.cljs$core$IFn$_invoke$arity$variadic(G__158205,G__158206,G__158207,G__158208,G__158209,G__158210,G__158211,seq158204__$7);
}));

(com.wsscode.pathom3.connect.planner.update_node.cljs$lang$maxFixedArity = (7));

/**
 * Returns the root node of the graph.
 */
com.wsscode.pathom3.connect.planner.get_root_node = (function com$wsscode$pathom3$connect$planner$get_root_node(p__158224){
var map__158225 = p__158224;
var map__158225__$1 = cljs.core.__destructure_map(map__158225);
var graph = map__158225__$1;
var root = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158225__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212));
return com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,root);
});
com.wsscode.pathom3.connect.planner.set_root_node = (function com$wsscode$pathom3$connect$planner$set_root_node(graph,node_id){
if(cljs.core.truth_(node_id)){
return cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(graph,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212),node_id);
} else {
return cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(graph,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212));
}
});
/**
 * Return node branches, which can be the ::run-and or the ::run-or part of the node.
 */
com.wsscode.pathom3.connect.planner.node_branches = (function com$wsscode$pathom3$connect$planner$node_branches(node){
var or__4223__auto__ = new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-and","com.wsscode.pathom3.connect.planner/run-and",-1356844884).cljs$core$IFn$_invoke$arity$1(node);
if(cljs.core.truth_(or__4223__auto__)){
return or__4223__auto__;
} else {
return new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-or","com.wsscode.pathom3.connect.planner/run-or",-672801891).cljs$core$IFn$_invoke$arity$1(node);
}
});
/**
 * Returns true when the node is a branch node type.
 */
com.wsscode.pathom3.connect.planner.branch_node_QMARK_ = (function com$wsscode$pathom3$connect$planner$branch_node_QMARK_(node){
return cljs.core.boolean$(com.wsscode.pathom3.connect.planner.node_branches(node));
});
/**
 * Return a keyword describing the type of the node.
 */
com.wsscode.pathom3.connect.planner.node_kind = (function com$wsscode$pathom3$connect$planner$node_kind(node){
if(cljs.core.truth_(new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049).cljs$core$IFn$_invoke$arity$1(node))){
return new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-resolver","com.wsscode.pathom3.connect.planner/node-resolver",391730247);
} else {
if(cljs.core.truth_(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-and","com.wsscode.pathom3.connect.planner/run-and",-1356844884).cljs$core$IFn$_invoke$arity$1(node))){
return new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-and","com.wsscode.pathom3.connect.planner/node-and",2027136749);
} else {
if(cljs.core.truth_(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-or","com.wsscode.pathom3.connect.planner/run-or",-672801891).cljs$core$IFn$_invoke$arity$1(node))){
return new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-or","com.wsscode.pathom3.connect.planner/node-or",-1576441526);
} else {
return new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-unknown","com.wsscode.pathom3.connect.planner/node-unknown",-1165199202);

}
}
}
});
/**
 * Return a string representation for the node, for resolver nodes this is the
 *   symbol, branch nodes get AND / OR respectively.
 */
com.wsscode.pathom3.connect.planner.node__GT_label = (function com$wsscode$pathom3$connect$planner$node__GT_label(node){
return cljs.core.str.cljs$core$IFn$_invoke$arity$1((function (){var or__4223__auto__ = new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049).cljs$core$IFn$_invoke$arity$1(node);
if(cljs.core.truth_(or__4223__auto__)){
return or__4223__auto__;
} else {
var or__4223__auto____$1 = (cljs.core.truth_(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-and","com.wsscode.pathom3.connect.planner/run-and",-1356844884).cljs$core$IFn$_invoke$arity$1(node))?"AND":null);
if(cljs.core.truth_(or__4223__auto____$1)){
return or__4223__auto____$1;
} else {
if(cljs.core.truth_(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-or","com.wsscode.pathom3.connect.planner/run-or",-672801891).cljs$core$IFn$_invoke$arity$1(node))){
return "OR";
} else {
return null;
}
}
}
})());
});
com.wsscode.pathom3.connect.planner.add_node_parent = (function com$wsscode$pathom3$connect$planner$add_node_parent(graph,node_id,node_parent_id){
if(cljs.core.truth_(node_parent_id)){
} else {
throw (new Error(["Assert failed: ","Tried to add after node with nil value","\n","node-parent-id"].join('')));
}

return com.wsscode.pathom3.connect.planner.update_node.cljs$core$IFn$_invoke$arity$5(graph,node_id,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-parents","com.wsscode.pathom3.connect.planner/node-parents",-690861122),com.wsscode.misc.coll.sconj,node_parent_id);
});
com.wsscode.pathom3.connect.planner.remove_node_parent = (function com$wsscode$pathom3$connect$planner$remove_node_parent(graph,node_id,node_parent_id){
var node = com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,node_id);
var node_parents_SINGLEQUOTE_ = cljs.core.disj.cljs$core$IFn$_invoke$arity$2(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-parents","com.wsscode.pathom3.connect.planner/node-parents",-690861122).cljs$core$IFn$_invoke$arity$2(node,cljs.core.PersistentHashSet.EMPTY),node_parent_id);
if(cljs.core.seq(node_parents_SINGLEQUOTE_)){
return com.wsscode.pathom3.connect.planner.assoc_node(graph,node_id,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-parents","com.wsscode.pathom3.connect.planner/node-parents",-690861122),node_parents_SINGLEQUOTE_);
} else {
if(cljs.core.truth_(node)){
return cljs.core.update_in.cljs$core$IFn$_invoke$arity$4(graph,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574),node_id], null),cljs.core.dissoc,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-parents","com.wsscode.pathom3.connect.planner/node-parents",-690861122));
} else {
return graph;
}
}
});
/**
 * Update the node-id run-next value, if run-next is nil the attribute
 *   will be removed from the map.
 */
com.wsscode.pathom3.connect.planner.set_node_run_next_STAR_ = (function com$wsscode$pathom3$connect$planner$set_node_run_next_STAR_(graph,node_id,run_next){
if(cljs.core.truth_(run_next)){
return com.wsscode.pathom3.connect.planner.assoc_node(graph,node_id,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-next","com.wsscode.pathom3.connect.planner/run-next",285457140),run_next);
} else {
return cljs.core.update_in.cljs$core$IFn$_invoke$arity$4(graph,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574),node_id], null),cljs.core.dissoc,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-next","com.wsscode.pathom3.connect.planner/run-next",285457140));
}
});
/**
 * Set the node run next value and add the node-parent counter part. Noop if target
 *   and run next are the same node.
 */
com.wsscode.pathom3.connect.planner.set_node_run_next = (function com$wsscode$pathom3$connect$planner$set_node_run_next(var_args){
var G__158233 = arguments.length;
switch (G__158233) {
case 2:
return com.wsscode.pathom3.connect.planner.set_node_run_next.cljs$core$IFn$_invoke$arity$2((arguments[(0)]),(arguments[(1)]));

break;
case 3:
return com.wsscode.pathom3.connect.planner.set_node_run_next.cljs$core$IFn$_invoke$arity$3((arguments[(0)]),(arguments[(1)]),(arguments[(2)]));

break;
default:
throw (new Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join('')));

}
});

(com.wsscode.pathom3.connect.planner.set_node_run_next.cljs$core$IFn$_invoke$arity$2 = (function (graph,run_next){
return com.wsscode.pathom3.connect.planner.set_node_run_next.cljs$core$IFn$_invoke$arity$3(graph,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212).cljs$core$IFn$_invoke$arity$1(graph),run_next);
}));

(com.wsscode.pathom3.connect.planner.set_node_run_next.cljs$core$IFn$_invoke$arity$3 = (function (graph,target_node_id,run_next){
var map__158238 = com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,target_node_id);
var map__158238__$1 = cljs.core.__destructure_map(map__158238);
var target_run_next = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158238__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-next","com.wsscode.pathom3.connect.planner/run-next",285457140));
var graph__$1 = (cljs.core.truth_(target_run_next)?com.wsscode.pathom3.connect.planner.remove_node_parent(graph,target_run_next,target_node_id):graph);
if(cljs.core.not(run_next)){
return com.wsscode.pathom3.connect.planner.set_node_run_next_STAR_(graph__$1,target_node_id,run_next);
} else {
if(cljs.core.truth_((function (){var and__4221__auto__ = run_next;
if(cljs.core.truth_(and__4221__auto__)){
return cljs.core.not_EQ_.cljs$core$IFn$_invoke$arity$2(target_node_id,run_next);
} else {
return and__4221__auto__;
}
})())){
return com.wsscode.pathom3.connect.planner.add_node_parent(com.wsscode.pathom3.connect.planner.set_node_run_next_STAR_(graph__$1,target_node_id,run_next),run_next,target_node_id);
} else {
return graph__$1;

}
}
}));

(com.wsscode.pathom3.connect.planner.set_node_run_next.cljs$lang$maxFixedArity = 3);

com.wsscode.pathom3.connect.planner.set_node_source_for_attrs = (function com$wsscode$pathom3$connect$planner$set_node_source_for_attrs(var_args){
var G__158240 = arguments.length;
switch (G__158240) {
case 2:
return com.wsscode.pathom3.connect.planner.set_node_source_for_attrs.cljs$core$IFn$_invoke$arity$2((arguments[(0)]),(arguments[(1)]));

break;
case 3:
return com.wsscode.pathom3.connect.planner.set_node_source_for_attrs.cljs$core$IFn$_invoke$arity$3((arguments[(0)]),(arguments[(1)]),(arguments[(2)]));

break;
default:
throw (new Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join('')));

}
});

(com.wsscode.pathom3.connect.planner.set_node_source_for_attrs.cljs$core$IFn$_invoke$arity$2 = (function (graph,env){
return com.wsscode.pathom3.connect.planner.set_node_source_for_attrs.cljs$core$IFn$_invoke$arity$3(graph,env,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212).cljs$core$IFn$_invoke$arity$1(graph));
}));

(com.wsscode.pathom3.connect.planner.set_node_source_for_attrs.cljs$core$IFn$_invoke$arity$3 = (function (graph,p__158241,node_id){
var map__158242 = p__158241;
var map__158242__$1 = cljs.core.__destructure_map(map__158242);
var attribute = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158242__$1,new cljs.core.Keyword("com.wsscode.pathom3.attribute","attribute","com.wsscode.pathom3.attribute/attribute",1003469786));
if(cljs.core.truth_(node_id)){
return cljs.core.update_in.cljs$core$IFn$_invoke$arity$4(graph,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","index-attrs","com.wsscode.pathom3.connect.planner/index-attrs",-2110590142),attribute], null),com.wsscode.misc.coll.sconj,node_id);
} else {
return graph;
}
}));

(com.wsscode.pathom3.connect.planner.set_node_source_for_attrs.cljs$lang$maxFixedArity = 3);

com.wsscode.pathom3.connect.planner.add_branch_to_node = (function com$wsscode$pathom3$connect$planner$add_branch_to_node(graph,target_node_id,branch_type,new_branch_node_id){
return com.wsscode.pathom3.connect.planner.update_node.cljs$core$IFn$_invoke$arity$5(com.wsscode.pathom3.connect.planner.add_node_parent(graph,new_branch_node_id,target_node_id),target_node_id,branch_type,com.wsscode.misc.coll.sconj,new_branch_node_id);
});
com.wsscode.pathom3.connect.planner.add_node_branches = (function com$wsscode$pathom3$connect$planner$add_node_branches(graph,target_node_id,branch_type,node_ids){
return cljs.core.reduce.cljs$core$IFn$_invoke$arity$3((function (g,node_id){
return com.wsscode.pathom3.connect.planner.add_branch_to_node(g,target_node_id,branch_type,node_id);
}),graph,node_ids);
});
/**
 * When node-id is a branch node, remove all node-parents associated from its children.
 */
com.wsscode.pathom3.connect.planner.remove_branch_node_parents = (function com$wsscode$pathom3$connect$planner$remove_branch_node_parents(graph,node_id){
var node = com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,node_id);
var temp__5751__auto__ = com.wsscode.pathom3.connect.planner.node_branches(node);
if(cljs.core.truth_(temp__5751__auto__)){
var branches = temp__5751__auto__;
return cljs.core.reduce.cljs$core$IFn$_invoke$arity$3((function (g,n_id){
return com.wsscode.pathom3.connect.planner.remove_node_parent(g,n_id,node_id);
}),graph,branches);
} else {
return graph;
}
});
/**
 * Disconnect a branch node from its parents.
 */
com.wsscode.pathom3.connect.planner.remove_from_parent_branches = (function com$wsscode$pathom3$connect$planner$remove_from_parent_branches(graph,p__158244){
var map__158245 = p__158244;
var map__158245__$1 = cljs.core.__destructure_map(map__158245);
var node_id = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158245__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707));
var node_parents = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158245__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-parents","com.wsscode.pathom3.connect.planner/node-parents",-690861122));
return cljs.core.reduce.cljs$core$IFn$_invoke$arity$3((function (g,nid){
var n = com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,nid);
if(cljs.core.contains_QMARK_(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-and","com.wsscode.pathom3.connect.planner/run-and",-1356844884).cljs$core$IFn$_invoke$arity$1(n),node_id)){
return com.wsscode.pathom3.connect.planner.update_node.cljs$core$IFn$_invoke$arity$5(graph,nid,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-and","com.wsscode.pathom3.connect.planner/run-and",-1356844884),cljs.core.disj,node_id);
} else {
if(cljs.core.contains_QMARK_(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-or","com.wsscode.pathom3.connect.planner/run-or",-672801891).cljs$core$IFn$_invoke$arity$1(n),node_id)){
return com.wsscode.pathom3.connect.planner.update_node.cljs$core$IFn$_invoke$arity$5(graph,nid,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-or","com.wsscode.pathom3.connect.planner/run-or",-672801891),cljs.core.disj,node_id);
} else {
return g;

}
}
}),graph,node_parents);
});
/**
 * Remove all node connections. This disconnect the nodes from parents and run-next.
 */
com.wsscode.pathom3.connect.planner.remove_node_edges = (function com$wsscode$pathom3$connect$planner$remove_node_edges(graph,node_id){
return com.wsscode.pathom3.connect.planner.remove_from_parent_branches(graph,node_id);
});
/**
 * Remove a node from the graph. Doesn't remove any references, caution!
 */
com.wsscode.pathom3.connect.planner.remove_node_STAR_ = (function com$wsscode$pathom3$connect$planner$remove_node_STAR_(graph,node_id){
var node = com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,node_id);
return cljs.core.update.cljs$core$IFn$_invoke$arity$4((function (){var G__158248 = graph;
if(cljs.core.truth_(new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049).cljs$core$IFn$_invoke$arity$1(node))){
return cljs.core.update_in.cljs$core$IFn$_invoke$arity$4(G__158248,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","index-resolver->nodes","com.wsscode.pathom3.connect.planner/index-resolver->nodes",-1876314434),new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049).cljs$core$IFn$_invoke$arity$1(node)], null),cljs.core.disj,node_id);
} else {
return G__158248;
}
})(),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574),cljs.core.dissoc,node_id);
});
/**
 * Remove a node from the graph. In case of resolver nodes it also removes them
 *   from the ::index-syms and after node references.
 */
com.wsscode.pathom3.connect.planner.remove_node = (function com$wsscode$pathom3$connect$planner$remove_node(graph,node_id){
var map__158250 = com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,node_id);
var map__158250__$1 = cljs.core.__destructure_map(map__158250);
var node = map__158250__$1;
var run_next = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158250__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-next","com.wsscode.pathom3.connect.planner/run-next",285457140));
var node_parents = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158250__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-parents","com.wsscode.pathom3.connect.planner/node-parents",-690861122));
if((cljs.core.truth_(node_parents)?cljs.core.every_QMARK_((function (p1__158249_SHARP_){
return cljs.core.not_EQ_.cljs$core$IFn$_invoke$arity$2(node_id,com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$3(graph,p1__158249_SHARP_,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-next","com.wsscode.pathom3.connect.planner/run-next",285457140)));
}),node_parents):true)){
} else {
throw (new Error(["Assert failed: ",["Tried to remove node ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(node_id)," that still contains references pointing to it. Move\n      the run-next references from the pointer nodes before removing it. Also check if\n      parent is branch and trying to merge."].join(''),"\n","(if node-parents (every? (fn* [p1__158249#] (not= node-id (get-node graph p1__158249# :com.wsscode.pathom3.connect.planner/run-next))) node-parents) true)"].join('')));
}

return com.wsscode.pathom3.connect.planner.remove_node_STAR_(com.wsscode.pathom3.connect.planner.remove_from_parent_branches(com.wsscode.pathom3.connect.planner.remove_node_parent(com.wsscode.pathom3.connect.planner.remove_branch_node_parents(graph,node_id),run_next,node_id),node),node_id);
});
/**
 * Remove a complete node cluster, starting from some node root.
 */
com.wsscode.pathom3.connect.planner.remove_root_node_cluster = (function com$wsscode$pathom3$connect$planner$remove_root_node_cluster(graph,node_ids){
while(true){
if(cljs.core.seq(node_ids)){
var vec__158251 = node_ids;
var seq__158252 = cljs.core.seq(vec__158251);
var first__158253 = cljs.core.first(seq__158252);
var seq__158252__$1 = cljs.core.next(seq__158252);
var node_id = first__158253;
var rest = seq__158252__$1;
var map__158254 = com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,node_id);
var map__158254__$1 = cljs.core.__destructure_map(map__158254);
var node = map__158254__$1;
var run_next = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158254__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-next","com.wsscode.pathom3.connect.planner/run-next",285457140));
var branches = (function (){var or__4223__auto__ = com.wsscode.pathom3.connect.planner.node_branches(node);
if(cljs.core.truth_(or__4223__auto__)){
return or__4223__auto__;
} else {
return cljs.core.PersistentHashSet.EMPTY;
}
})();
var next_nodes = (function (){var G__158255 = branches;
if(cljs.core.truth_(run_next)){
return cljs.core.conj.cljs$core$IFn$_invoke$arity$2(G__158255,run_next);
} else {
return G__158255;
}
})();
var G__158484 = com.wsscode.pathom3.connect.planner.remove_node_STAR_(graph,node_id);
var G__158485 = cljs.core.into.cljs$core$IFn$_invoke$arity$2(rest,next_nodes);
graph = G__158484;
node_ids = G__158485;
continue;
} else {
return graph;
}
break;
}
});
/**
 * Add new node to the graph, this add the node and the index of in ::index-syms.
 */
com.wsscode.pathom3.connect.planner.include_node = (function com$wsscode$pathom3$connect$planner$include_node(graph,p__158256){
var map__158257 = p__158256;
var map__158257__$1 = cljs.core.__destructure_map(map__158257);
var node = map__158257__$1;
var node_id = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158257__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707));
var op_name = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158257__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049));
var G__158258 = cljs.core.assoc_in(graph,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574),node_id], null),node);
if(cljs.core.truth_(op_name)){
return cljs.core.update_in.cljs$core$IFn$_invoke$arity$4(G__158258,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","index-resolver->nodes","com.wsscode.pathom3.connect.planner/index-resolver->nodes",-1876314434),op_name], null),com.wsscode.misc.coll.sconj,node_id);
} else {
return G__158258;
}
});
com.wsscode.pathom3.connect.planner.create_and = (function com$wsscode$pathom3$connect$planner$create_and(graph,env,node_ids){
if(cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2((1),cljs.core.count(node_ids))){
return com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,cljs.core.first(node_ids));
} else {
var map__158259 = com.wsscode.pathom3.connect.planner.new_node(env,cljs.core.PersistentArrayMap.EMPTY);
var map__158259__$1 = cljs.core.__destructure_map(map__158259);
var and_node = map__158259__$1;
var and_node_id = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158259__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707));
return com.wsscode.pathom3.connect.planner.add_node_branches(com.wsscode.pathom3.connect.planner.include_node(graph,and_node),and_node_id,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-and","com.wsscode.pathom3.connect.planner/run-and",-1356844884),node_ids);
}
});
com.wsscode.pathom3.connect.planner.create_root_and = (function com$wsscode$pathom3$connect$planner$create_root_and(graph,env,node_ids){
if(cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2((1),cljs.core.count(node_ids))){
return com.wsscode.pathom3.connect.planner.set_root_node(graph,cljs.core.first(node_ids));
} else {
var map__158260 = com.wsscode.pathom3.connect.planner.new_node(env,cljs.core.PersistentArrayMap.EMPTY);
var map__158260__$1 = cljs.core.__destructure_map(map__158260);
var and_node = map__158260__$1;
var and_node_id = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158260__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707));
var _LT__GT_ = com.wsscode.pathom3.connect.planner.set_root_node(com.wsscode.pathom3.connect.planner.add_node_branches(com.wsscode.pathom3.connect.planner.include_node(graph,and_node),and_node_id,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-and","com.wsscode.pathom3.connect.planner/run-and",-1356844884),node_ids),and_node_id);
var G__158261 = _LT__GT_;
var G__158262 = env;
var G__158263 = new cljs.core.PersistentArrayMap(null, 4, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-event","com.wsscode.pathom3.connect.planner/snapshot-event",-122347979),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-create-and","com.wsscode.pathom3.connect.planner/snapshot-create-and",811113842),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),"Create root AND",new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","highlight-nodes","com.wsscode.pathom3.connect.planner/highlight-nodes",-1697917026),cljs.core.into.cljs$core$IFn$_invoke$arity$2(cljs.core.PersistentHashSet.createAsIfByAssoc([new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212).cljs$core$IFn$_invoke$arity$1(_LT__GT_)]),node_ids),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","highlight-styles","com.wsscode.pathom3.connect.planner/highlight-styles",1086922280),cljs.core.PersistentArrayMap.createAsIfByAssoc([new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212).cljs$core$IFn$_invoke$arity$1(_LT__GT_),(1)])], null);
return (com.wsscode.pathom3.connect.planner.add_snapshot_BANG_.cljs$core$IFn$_invoke$arity$3 ? com.wsscode.pathom3.connect.planner.add_snapshot_BANG_.cljs$core$IFn$_invoke$arity$3(G__158261,G__158262,G__158263) : com.wsscode.pathom3.connect.planner.add_snapshot_BANG_.call(null,G__158261,G__158262,G__158263));
}
});
com.wsscode.pathom3.connect.planner.create_root_or = (function com$wsscode$pathom3$connect$planner$create_root_or(graph,p__158264,node_ids){
var map__158265 = p__158264;
var map__158265__$1 = cljs.core.__destructure_map(map__158265);
var env = map__158265__$1;
var attribute = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158265__$1,new cljs.core.Keyword("com.wsscode.pathom3.attribute","attribute","com.wsscode.pathom3.attribute/attribute",1003469786));
if(cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2((1),cljs.core.count(node_ids))){
return com.wsscode.pathom3.connect.planner.set_root_node(graph,cljs.core.first(node_ids));
} else {
var map__158266 = com.wsscode.pathom3.connect.planner.new_node(env,new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","expects","com.wsscode.pathom3.connect.planner/expects",2018136040),cljs.core.PersistentArrayMap.createAsIfByAssoc([attribute,cljs.core.PersistentArrayMap.EMPTY])], null));
var map__158266__$1 = cljs.core.__destructure_map(map__158266);
var or_node = map__158266__$1;
var or_node_id = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158266__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707));
var _LT__GT_ = com.wsscode.pathom3.connect.planner.set_root_node(com.wsscode.pathom3.connect.planner.add_node_branches(com.wsscode.pathom3.connect.planner.include_node(graph,or_node),or_node_id,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-or","com.wsscode.pathom3.connect.planner/run-or",-672801891),node_ids),or_node_id);
var G__158267 = _LT__GT_;
var G__158268 = env;
var G__158269 = new cljs.core.PersistentArrayMap(null, 4, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-event","com.wsscode.pathom3.connect.planner/snapshot-event",-122347979),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-create-or","com.wsscode.pathom3.connect.planner/snapshot-create-or",1253927982),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),"Create root OR",new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","highlight-nodes","com.wsscode.pathom3.connect.planner/highlight-nodes",-1697917026),cljs.core.into.cljs$core$IFn$_invoke$arity$2(cljs.core.PersistentHashSet.createAsIfByAssoc([new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212).cljs$core$IFn$_invoke$arity$1(_LT__GT_)]),node_ids),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","highlight-styles","com.wsscode.pathom3.connect.planner/highlight-styles",1086922280),cljs.core.PersistentArrayMap.createAsIfByAssoc([new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212).cljs$core$IFn$_invoke$arity$1(_LT__GT_),(1)])], null);
return (com.wsscode.pathom3.connect.planner.add_snapshot_BANG_.cljs$core$IFn$_invoke$arity$3 ? com.wsscode.pathom3.connect.planner.add_snapshot_BANG_.cljs$core$IFn$_invoke$arity$3(G__158267,G__158268,G__158269) : com.wsscode.pathom3.connect.planner.add_snapshot_BANG_.call(null,G__158267,G__158268,G__158269));
}
});
/**
 * For a specific attribute, return a vector containing the provides of each node of
 *   that resolver.
 */
com.wsscode.pathom3.connect.planner.node_attribute_provides = (function com$wsscode$pathom3$connect$planner$node_attribute_provides(graph,env,attr){
var G__158271 = cljs.core.get_in.cljs$core$IFn$_invoke$arity$2(graph,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","index-attrs","com.wsscode.pathom3.connect.planner/index-attrs",-2110590142),attr], null));
if((G__158271 == null)){
return null;
} else {
return cljs.core.mapv.cljs$core$IFn$_invoke$arity$2((function (p1__158270_SHARP_){
return cljs.core.get.cljs$core$IFn$_invoke$arity$2(new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","provides","com.wsscode.pathom3.connect.operation/provides",541419618).cljs$core$IFn$_invoke$arity$1(com.wsscode.pathom3.connect.planner.node_with_resolver_config(graph,env,p1__158270_SHARP_)),attr);
}),G__158271);
}
});
/**
 * Transfer the node parent from source node to target node. This function will also
 *   update the parents references to point to target node.
 */
com.wsscode.pathom3.connect.planner.transfer_node_parent = (function com$wsscode$pathom3$connect$planner$transfer_node_parent(graph,target_node_id,source_node_id,node_id){
var _LT__GT_ = com.wsscode.pathom3.connect.planner.add_node_parent(com.wsscode.pathom3.connect.planner.remove_node_parent(graph,source_node_id,node_id),target_node_id,node_id);
if(cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$3(graph,node_id,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-next","com.wsscode.pathom3.connect.planner/run-next",285457140)),source_node_id)){
return com.wsscode.pathom3.connect.planner.set_node_run_next_STAR_(_LT__GT_,node_id,target_node_id);
} else {
if(cljs.core.contains_QMARK_(com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$3(graph,node_id,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-and","com.wsscode.pathom3.connect.planner/run-and",-1356844884)),source_node_id)){
return com.wsscode.pathom3.connect.planner.update_node.cljs$core$IFn$_invoke$arity$5(com.wsscode.pathom3.connect.planner.add_branch_to_node(_LT__GT_,node_id,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-and","com.wsscode.pathom3.connect.planner/run-and",-1356844884),target_node_id),node_id,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-and","com.wsscode.pathom3.connect.planner/run-and",-1356844884),cljs.core.disj,source_node_id);
} else {
if(cljs.core.contains_QMARK_(com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$3(graph,node_id,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-or","com.wsscode.pathom3.connect.planner/run-or",-672801891)),source_node_id)){
return com.wsscode.pathom3.connect.planner.update_node.cljs$core$IFn$_invoke$arity$5(com.wsscode.pathom3.connect.planner.add_branch_to_node(_LT__GT_,node_id,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-or","com.wsscode.pathom3.connect.planner/run-or",-672801891),target_node_id),node_id,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-or","com.wsscode.pathom3.connect.planner/run-or",-672801891),cljs.core.disj,source_node_id);
} else {
return _LT__GT_;

}
}
}
});
/**
 * Transfer node parents from source node to target node. In case source node is root,
 *   the root will be transferred to target node.
 */
com.wsscode.pathom3.connect.planner.transfer_node_parents = (function com$wsscode$pathom3$connect$planner$transfer_node_parents(graph,target_node_id,source_node_id){
var parents = com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$3(graph,source_node_id,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-parents","com.wsscode.pathom3.connect.planner/node-parents",-690861122));
var _LT__GT_ = (function (){var G__158272 = graph;
if(cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212).cljs$core$IFn$_invoke$arity$1(graph),source_node_id)){
return com.wsscode.pathom3.connect.planner.set_root_node(G__158272,target_node_id);
} else {
return G__158272;
}
})();
return cljs.core.reduce.cljs$core$IFn$_invoke$arity$3((function (g,node_id){
return com.wsscode.pathom3.connect.planner.transfer_node_parent(g,target_node_id,source_node_id,node_id);
}),_LT__GT_,parents);
});
com.wsscode.pathom3.connect.planner.combine_expects = (function com$wsscode$pathom3$connect$planner$combine_expects(na,nb){
return cljs.core.update.cljs$core$IFn$_invoke$arity$4(na,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","expects","com.wsscode.pathom3.connect.planner/expects",2018136040),com.wsscode.pathom3.format.shape_descriptor.merge_shapes,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","expects","com.wsscode.pathom3.connect.planner/expects",2018136040).cljs$core$IFn$_invoke$arity$1(nb));
});
com.wsscode.pathom3.connect.planner.combine_foreign_ast = (function com$wsscode$pathom3$connect$planner$combine_foreign_ast(na,nb){
if(cljs.core.truth_(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","foreign-ast","com.wsscode.pathom3.connect.planner/foreign-ast",1579399548).cljs$core$IFn$_invoke$arity$1(na))){
return cljs.core.update.cljs$core$IFn$_invoke$arity$4(na,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","foreign-ast","com.wsscode.pathom3.connect.planner/foreign-ast",1579399548),com.wsscode.pathom3.format.eql.merge_ast_children,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","foreign-ast","com.wsscode.pathom3.connect.planner/foreign-ast",1579399548).cljs$core$IFn$_invoke$arity$1(nb));
} else {
return na;
}
});
com.wsscode.pathom3.connect.planner.transfer_node_indexes = (function com$wsscode$pathom3$connect$planner$transfer_node_indexes(graph,target_node_id,source_node_id){
var attrs = cljs.core.keys(com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$3(graph,source_node_id,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","expects","com.wsscode.pathom3.connect.planner/expects",2018136040)));
return cljs.core.reduce.cljs$core$IFn$_invoke$arity$3((function (graph__$1,attr){
return cljs.core.update_in.cljs$core$IFn$_invoke$arity$4(cljs.core.update_in.cljs$core$IFn$_invoke$arity$4(graph__$1,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","index-attrs","com.wsscode.pathom3.connect.planner/index-attrs",-2110590142),attr], null),com.wsscode.misc.coll.sconj,target_node_id),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","index-attrs","com.wsscode.pathom3.connect.planner/index-attrs",-2110590142),attr], null),cljs.core.disj,source_node_id);
}),graph,attrs);
});
com.wsscode.pathom3.connect.planner.combine_run_next = (function com$wsscode$pathom3$connect$planner$combine_run_next(graph,env,node_ids,pivot){
var run_next_nodes = cljs.core.into.cljs$core$IFn$_invoke$arity$3(cljs.core.PersistentVector.EMPTY,cljs.core.comp.cljs$core$IFn$_invoke$arity$2(cljs.core.map.cljs$core$IFn$_invoke$arity$1((function (p1__158273_SHARP_){
return com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,p1__158273_SHARP_);
})),cljs.core.filter.cljs$core$IFn$_invoke$arity$1(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-next","com.wsscode.pathom3.connect.planner/run-next",285457140))),node_ids);
if(cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2((1),cljs.core.count(run_next_nodes))){
var map__158274 = cljs.core.first(run_next_nodes);
var map__158274__$1 = cljs.core.__destructure_map(map__158274);
var node_id = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158274__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707));
var run_next = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158274__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-next","com.wsscode.pathom3.connect.planner/run-next",285457140));
return com.wsscode.pathom3.connect.planner.set_node_run_next.cljs$core$IFn$_invoke$arity$3(com.wsscode.pathom3.connect.planner.remove_node_parent(graph,run_next,node_id),pivot,run_next);
} else {
if(cljs.core.seq(run_next_nodes)){
var and_node = com.wsscode.pathom3.connect.planner.new_node(env,new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-and","com.wsscode.pathom3.connect.planner/run-and",-1356844884),cljs.core.PersistentHashSet.EMPTY], null));
var _LT__GT_ = graph;
var _LT__GT___$1 = com.wsscode.pathom3.connect.planner.include_node(_LT__GT_,and_node);
var _LT__GT___$2 = cljs.core.reduce.cljs$core$IFn$_invoke$arity$3((function (g,p__158275){
var map__158276 = p__158275;
var map__158276__$1 = cljs.core.__destructure_map(map__158276);
var node_id = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158276__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707));
var run_next = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158276__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-next","com.wsscode.pathom3.connect.planner/run-next",285457140));
return com.wsscode.pathom3.connect.planner.remove_node_parent(com.wsscode.pathom3.connect.planner.add_branch_to_node(g,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707).cljs$core$IFn$_invoke$arity$1(and_node),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-and","com.wsscode.pathom3.connect.planner/run-and",-1356844884),run_next),run_next,node_id);
}),_LT__GT___$1,run_next_nodes);
return com.wsscode.pathom3.connect.planner.set_node_run_next.cljs$core$IFn$_invoke$arity$3(_LT__GT___$2,pivot,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707).cljs$core$IFn$_invoke$arity$1(and_node));
} else {
return graph;

}
}
});
/**
 * When a branch node contains a single branch out, remove the AND node and put that
 *   single item in place.
 * 
 *   Note in case the branch has a run-next, that run-next gets moved to the end of chain
 *   to retain the same order as it would run with the branch.
 */
com.wsscode.pathom3.connect.planner.simplify_branch_node = (function com$wsscode$pathom3$connect$planner$simplify_branch_node(graph,env,node_id){
var node = com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,node_id);
var target_node_id = (function (){var and__4221__auto__ = cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2((1),cljs.core.count(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-and","com.wsscode.pathom3.connect.planner/run-and",-1356844884).cljs$core$IFn$_invoke$arity$1(node)));
if(and__4221__auto__){
var and__4221__auto____$1 = cljs.core.not(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-next","com.wsscode.pathom3.connect.planner/run-next",285457140).cljs$core$IFn$_invoke$arity$1(node));
if(and__4221__auto____$1){
return cljs.core.first(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-and","com.wsscode.pathom3.connect.planner/run-and",-1356844884).cljs$core$IFn$_invoke$arity$1(node));
} else {
return and__4221__auto____$1;
}
} else {
return and__4221__auto__;
}
})();
if(cljs.core.truth_(target_node_id)){
var G__158277 = com.wsscode.pathom3.connect.planner.remove_node(com.wsscode.pathom3.connect.planner.remove_node_edges(com.wsscode.pathom3.connect.planner.transfer_node_parents((function (){var G__158280 = graph;
var G__158281 = env;
var G__158282 = new cljs.core.PersistentArrayMap(null, 3, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),"Simplifying branch with single element",new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","highlight-nodes","com.wsscode.pathom3.connect.planner/highlight-nodes",-1697917026),cljs.core.PersistentHashSet.createAsIfByAssoc([target_node_id,node_id]),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","highlight-styles","com.wsscode.pathom3.connect.planner/highlight-styles",1086922280),cljs.core.PersistentArrayMap.createAsIfByAssoc([node_id,(1)])], null);
return (com.wsscode.pathom3.connect.planner.add_snapshot_BANG_.cljs$core$IFn$_invoke$arity$3 ? com.wsscode.pathom3.connect.planner.add_snapshot_BANG_.cljs$core$IFn$_invoke$arity$3(G__158280,G__158281,G__158282) : com.wsscode.pathom3.connect.planner.add_snapshot_BANG_.call(null,G__158280,G__158281,G__158282));
})(),target_node_id,node_id),node_id),node_id);
var G__158278 = env;
var G__158279 = new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),"Simplification done",new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","highlight-nodes","com.wsscode.pathom3.connect.planner/highlight-nodes",-1697917026),cljs.core.PersistentHashSet.createAsIfByAssoc([target_node_id])], null);
return (com.wsscode.pathom3.connect.planner.add_snapshot_BANG_.cljs$core$IFn$_invoke$arity$3 ? com.wsscode.pathom3.connect.planner.add_snapshot_BANG_.cljs$core$IFn$_invoke$arity$3(G__158277,G__158278,G__158279) : com.wsscode.pathom3.connect.planner.add_snapshot_BANG_.call(null,G__158277,G__158278,G__158279));
} else {
return graph;
}
});
/**
 * Merges data from source-node-id into target-node-id, them removes the source node.
 */
com.wsscode.pathom3.connect.planner.merge_sibling_resolver_node = (function com$wsscode$pathom3$connect$planner$merge_sibling_resolver_node(graph,target_node_id,source_node_id){
var source_node = com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,source_node_id);
return com.wsscode.pathom3.connect.planner.remove_node(com.wsscode.pathom3.connect.planner.remove_node_edges(com.wsscode.pathom3.connect.planner.transfer_node_indexes(com.wsscode.pathom3.connect.planner.update_node.cljs$core$IFn$_invoke$arity$5(com.wsscode.pathom3.connect.planner.update_node.cljs$core$IFn$_invoke$arity$5(com.wsscode.pathom3.connect.planner.update_node.cljs$core$IFn$_invoke$arity$5(graph,target_node_id,null,com.wsscode.misc.coll.merge_defaults,source_node),target_node_id,null,com.wsscode.pathom3.connect.planner.combine_expects,source_node),target_node_id,null,com.wsscode.pathom3.connect.planner.combine_foreign_ast,source_node),target_node_id,source_node_id),source_node_id),source_node_id);
});
com.wsscode.pathom3.connect.planner.merge_sibling_resolver_nodes_STAR_ = (function com$wsscode$pathom3$connect$planner$merge_sibling_resolver_nodes_STAR_(graph,pivot,node_ids){
return cljs.core.reduce.cljs$core$IFn$_invoke$arity$3((function (g,node_id){
return com.wsscode.pathom3.connect.planner.merge_sibling_resolver_node(g,pivot,node_id);
}),graph,node_ids);
});
com.wsscode.pathom3.connect.planner.merge_sibling_resolver_nodes = (function com$wsscode$pathom3$connect$planner$merge_sibling_resolver_nodes(graph,env,parent_node_id,node_ids){
var vec__158283 = node_ids;
var seq__158284 = cljs.core.seq(vec__158283);
var first__158285 = cljs.core.first(seq__158284);
var seq__158284__$1 = cljs.core.next(seq__158284);
var pivot = first__158285;
var node_ids_SINGLEQUOTE_ = seq__158284__$1;
var resolver = new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049).cljs$core$IFn$_invoke$arity$1(com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,pivot));
var G__158286_158497 = graph;
var G__158287_158498 = env;
var G__158288_158499 = new cljs.core.PersistentArrayMap(null, 3, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),["Merging sibling resolver calls to resolver ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(resolver)].join(''),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","highlight-nodes","com.wsscode.pathom3.connect.planner/highlight-nodes",-1697917026),cljs.core.into.cljs$core$IFn$_invoke$arity$2(cljs.core.PersistentHashSet.EMPTY,cljs.core.conj.cljs$core$IFn$_invoke$arity$2(node_ids,parent_node_id)),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","highlight-styles","com.wsscode.pathom3.connect.planner/highlight-styles",1086922280),cljs.core.PersistentArrayMap.createAsIfByAssoc([parent_node_id,(1)])], null);
(com.wsscode.pathom3.connect.planner.add_snapshot_BANG_.cljs$core$IFn$_invoke$arity$3 ? com.wsscode.pathom3.connect.planner.add_snapshot_BANG_.cljs$core$IFn$_invoke$arity$3(G__158286_158497,G__158287_158498,G__158288_158499) : com.wsscode.pathom3.connect.planner.add_snapshot_BANG_.call(null,G__158286_158497,G__158287_158498,G__158288_158499));

var G__158289 = com.wsscode.pathom3.connect.planner.merge_sibling_resolver_nodes_STAR_(com.wsscode.pathom3.connect.planner.combine_run_next(graph,env,node_ids,pivot),pivot,node_ids_SINGLEQUOTE_);
var G__158290 = env;
var G__158291 = new cljs.core.PersistentArrayMap(null, 3, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),"Merge complete",new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","highlight-nodes","com.wsscode.pathom3.connect.planner/highlight-nodes",-1697917026),cljs.core.PersistentHashSet.createAsIfByAssoc([pivot,parent_node_id]),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","highlight-styles","com.wsscode.pathom3.connect.planner/highlight-styles",1086922280),cljs.core.PersistentArrayMap.createAsIfByAssoc([parent_node_id,(1)])], null);
return (com.wsscode.pathom3.connect.planner.add_snapshot_BANG_.cljs$core$IFn$_invoke$arity$3 ? com.wsscode.pathom3.connect.planner.add_snapshot_BANG_.cljs$core$IFn$_invoke$arity$3(G__158289,G__158290,G__158291) : com.wsscode.pathom3.connect.planner.add_snapshot_BANG_.call(null,G__158289,G__158290,G__158291));
});
com.wsscode.pathom3.connect.planner.add_snapshot_BANG_ = (function com$wsscode$pathom3$connect$planner$add_snapshot_BANG_(graph,p__158293,event_details){
var map__158294 = p__158293;
var map__158294__$1 = cljs.core.__destructure_map(map__158294);
var snapshots_STAR_ = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158294__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshots*","com.wsscode.pathom3.connect.planner/snapshots*",-1855095128));
var snapshot_depth = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158294__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-depth","com.wsscode.pathom3.connect.planner/snapshot-depth",1034256870));
if(cljs.core.truth_(snapshots_STAR_)){
var pad_158500 = clojure.string.join.cljs$core$IFn$_invoke$arity$1(cljs.core.repeat.cljs$core$IFn$_invoke$arity$2((function (){var or__4223__auto__ = snapshot_depth;
if(cljs.core.truth_(or__4223__auto__)){
return or__4223__auto__;
} else {
return (0);
}
})(),"-"));
var pad_158501__$1 = ((cljs.core.seq(pad_158500))?[pad_158500," "].join(''):"");
var event_details_SINGLEQUOTE__158502 = com.wsscode.misc.coll.update_if.cljs$core$IFn$_invoke$arity$3(event_details,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),(function (p1__158292_SHARP_){
return [pad_158501__$1,cljs.core.str.cljs$core$IFn$_invoke$arity$1(p1__158292_SHARP_)].join('');
}));
cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$3(snapshots_STAR_,cljs.core.conj,cljs.core.merge.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([cljs.core.dissoc.cljs$core$IFn$_invoke$arity$variadic(graph,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","source-ast","com.wsscode.pathom3.connect.planner/source-ast",1604047106),cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","available-data","com.wsscode.pathom3.connect.planner/available-data",727921292)], 0)),event_details_SINGLEQUOTE__158502], 0)));
} else {
}

return graph;
});
com.wsscode.pathom3.connect.planner.base_graph = (function com$wsscode$pathom3$connect$planner$base_graph(){
return new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574),cljs.core.PersistentArrayMap.EMPTY], null);
});
com.wsscode.pathom3.connect.planner.base_env = (function com$wsscode$pathom3$connect$planner$base_env(){
return new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","id-counter","com.wsscode.pathom3.connect.planner/id-counter",1593852285),cljs.core.atom.cljs$core$IFn$_invoke$arity$1((0)),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","available-data","com.wsscode.pathom3.connect.planner/available-data",727921292),cljs.core.PersistentArrayMap.EMPTY], null);
});
/**
 * Restore the original environment sent to run-graph! Use this for nested graphs
 *   that need a clean environment.
 */
com.wsscode.pathom3.connect.planner.reset_env = (function com$wsscode$pathom3$connect$planner$reset_env(env){
var or__4223__auto__ = (function (){var G__158295 = env;
var G__158295__$1 = (((G__158295 == null))?null:cljs.core.meta(G__158295));
var G__158295__$2 = (((G__158295__$1 == null))?null:new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","original-env","com.wsscode.pathom3.connect.planner/original-env",-154232736).cljs$core$IFn$_invoke$arity$1(G__158295__$1));
if((G__158295__$2 == null)){
return null;
} else {
return cljs.core.with_meta(G__158295__$2,cljs.core.meta(env));
}
})();
if(cljs.core.truth_(or__4223__auto__)){
return or__4223__auto__;
} else {
return env;
}
});
/**
 * Add attribute to unreachable list
 */
com.wsscode.pathom3.connect.planner.add_unreachable_path = (function com$wsscode$pathom3$connect$planner$add_unreachable_path(graph,env,path){
return com.wsscode.pathom3.connect.planner.add_snapshot_BANG_(cljs.core.update.cljs$core$IFn$_invoke$arity$4(graph,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","unreachable-paths","com.wsscode.pathom3.connect.planner/unreachable-paths",614064297),com.wsscode.pathom3.format.shape_descriptor.merge_shapes,path),env,new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-event","com.wsscode.pathom3.connect.planner/snapshot-event",-122347979),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-mark-attr-unreachable","com.wsscode.pathom3.connect.planner/snapshot-mark-attr-unreachable",1348357148),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),["Mark path ",cljs.core.pr_str.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([path], 0))," as unreachable."].join('')], null));
});
com.wsscode.pathom3.connect.planner.add_warning = (function com$wsscode$pathom3$connect$planner$add_warning(graph,warn){
return cljs.core.update.cljs$core$IFn$_invoke$arity$4(graph,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","warnings","com.wsscode.pathom3.connect.planner/warnings",149755478),com.wsscode.misc.coll.vconj,warn);
});
/**
 * Copy unreachable attributes from discard-graph to target-graph. Using the extra arity
 *   you can also add a new unreachable path in the same call.
 */
com.wsscode.pathom3.connect.planner.merge_unreachable = (function com$wsscode$pathom3$connect$planner$merge_unreachable(var_args){
var G__158297 = arguments.length;
switch (G__158297) {
case 2:
return com.wsscode.pathom3.connect.planner.merge_unreachable.cljs$core$IFn$_invoke$arity$2((arguments[(0)]),(arguments[(1)]));

break;
case 4:
return com.wsscode.pathom3.connect.planner.merge_unreachable.cljs$core$IFn$_invoke$arity$4((arguments[(0)]),(arguments[(1)]),(arguments[(2)]),(arguments[(3)]));

break;
default:
throw (new Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join('')));

}
});

(com.wsscode.pathom3.connect.planner.merge_unreachable.cljs$core$IFn$_invoke$arity$2 = (function (target_graph,p__158298){
var map__158299 = p__158298;
var map__158299__$1 = cljs.core.__destructure_map(map__158299);
var unreachable_paths = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158299__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","unreachable-paths","com.wsscode.pathom3.connect.planner/unreachable-paths",614064297));
var G__158300 = target_graph;
if(cljs.core.truth_(unreachable_paths)){
return cljs.core.update.cljs$core$IFn$_invoke$arity$4(G__158300,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","unreachable-paths","com.wsscode.pathom3.connect.planner/unreachable-paths",614064297),com.wsscode.pathom3.format.shape_descriptor.merge_shapes,(function (){var or__4223__auto__ = unreachable_paths;
if(cljs.core.truth_(or__4223__auto__)){
return or__4223__auto__;
} else {
return cljs.core.PersistentArrayMap.EMPTY;
}
})());
} else {
return G__158300;
}
}));

(com.wsscode.pathom3.connect.planner.merge_unreachable.cljs$core$IFn$_invoke$arity$4 = (function (target_graph,graph,env,path){
return com.wsscode.pathom3.connect.planner.add_unreachable_path(com.wsscode.pathom3.connect.planner.merge_unreachable.cljs$core$IFn$_invoke$arity$2(target_graph,graph),env,path);
}));

(com.wsscode.pathom3.connect.planner.merge_unreachable.cljs$lang$maxFixedArity = 4);

/**
 * Get a set with all provided attributes from the graph.
 */
com.wsscode.pathom3.connect.planner.graph_provides = (function com$wsscode$pathom3$connect$planner$graph_provides(p__158301){
var map__158302 = p__158301;
var map__158302__$1 = cljs.core.__destructure_map(map__158302);
var index_attrs = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158302__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","index-attrs","com.wsscode.pathom3.connect.planner/index-attrs",-2110590142));
return cljs.core.set(cljs.core.keys(index_attrs));
});
/**
 * Find AST node a given entry from the source AST.
 */
com.wsscode.pathom3.connect.planner.entry_ast = (function com$wsscode$pathom3$connect$planner$entry_ast(graph,k){
return cljs.core.get_in.cljs$core$IFn$_invoke$arity$2(graph,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","index-ast","com.wsscode.pathom3.connect.planner/index-ast",905845713),k], null));
});
/**
 * Add information about attribute that is present but requires further processing
 *   due to subquery, this is created so the runner can quickly know which attributes
 *   need to have the subquery processing done.
 */
com.wsscode.pathom3.connect.planner.mark_attribute_process_sub_query = (function com$wsscode$pathom3$connect$planner$mark_attribute_process_sub_query(graph,p__158303){
var map__158304 = p__158303;
var map__158304__$1 = cljs.core.__destructure_map(map__158304);
var key = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158304__$1,new cljs.core.Keyword(null,"key","key",-1516042587));
var children = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158304__$1,new cljs.core.Keyword(null,"children","children",-940561982));
var query = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158304__$1,new cljs.core.Keyword(null,"query","query",-1288509510));
if(cljs.core.truth_((function (){var or__4223__auto__ = children;
if(cljs.core.truth_(or__4223__auto__)){
return or__4223__auto__;
} else {
return query;
}
})())){
return cljs.core.update.cljs$core$IFn$_invoke$arity$4(graph,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nested-process","com.wsscode.pathom3.connect.planner/nested-process",-35632382),com.wsscode.misc.coll.sconj,key);
} else {
return graph;
}
});
com.wsscode.pathom3.connect.planner.add_ident_process = (function com$wsscode$pathom3$connect$planner$add_ident_process(graph,p__158305){
var map__158306 = p__158305;
var map__158306__$1 = cljs.core.__destructure_map(map__158306);
var key = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158306__$1,new cljs.core.Keyword(null,"key","key",-1516042587));
return cljs.core.update.cljs$core$IFn$_invoke$arity$4(graph,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","idents","com.wsscode.pathom3.connect.planner/idents",-1156950100),com.wsscode.misc.coll.sconj,key);
});
com.wsscode.pathom3.connect.planner.add_placeholder_entry = (function com$wsscode$pathom3$connect$planner$add_placeholder_entry(graph,attr){
return cljs.core.update.cljs$core$IFn$_invoke$arity$4(graph,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","placeholders","com.wsscode.pathom3.connect.planner/placeholders",-1690563362),com.wsscode.misc.coll.sconj,attr);
});
/**
 * Direct successors of node, branch nodes and run-next, in case of branch nodes the
 *   branches will always come before the run-next.
 */
com.wsscode.pathom3.connect.planner.find_direct_node_successors = (function com$wsscode$pathom3$connect$planner$find_direct_node_successors(p__158307){
var map__158308 = p__158307;
var map__158308__$1 = cljs.core.__destructure_map(map__158308);
var node = map__158308__$1;
var run_next = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158308__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-next","com.wsscode.pathom3.connect.planner/run-next",285457140));
var branches = com.wsscode.pathom3.connect.planner.node_branches(node);
var G__158309 = cljs.core.PersistentVector.EMPTY;
var G__158309__$1 = (cljs.core.truth_(branches)?cljs.core.into.cljs$core$IFn$_invoke$arity$2(G__158309,branches):G__158309);
if(cljs.core.truth_(run_next)){
return cljs.core.conj.cljs$core$IFn$_invoke$arity$2(G__158309__$1,run_next);
} else {
return G__158309__$1;
}
});
/**
 * Return all node ancestors. The order of the output will go from closest to farthest
 *   nodes, like breathing out of the current node.
 */
com.wsscode.pathom3.connect.planner.node_ancestors = (function com$wsscode$pathom3$connect$planner$node_ancestors(graph,node_id){
var node_queue = com.wsscode.misc.coll.queue.cljs$core$IFn$_invoke$arity$1(new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [node_id], null));
var ancestors = cljs.core.PersistentVector.EMPTY;
while(true){
var temp__5751__auto__ = cljs.core.peek(node_queue);
if(cljs.core.truth_(temp__5751__auto__)){
var node_id_SINGLEQUOTE_ = temp__5751__auto__;
var map__158311 = com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,node_id_SINGLEQUOTE_);
var map__158311__$1 = cljs.core.__destructure_map(map__158311);
var node_parents = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158311__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-parents","com.wsscode.pathom3.connect.planner/node-parents",-690861122));
var G__158511 = cljs.core.into.cljs$core$IFn$_invoke$arity$2(cljs.core.pop(node_queue),node_parents);
var G__158512 = cljs.core.conj.cljs$core$IFn$_invoke$arity$2(ancestors,node_id_SINGLEQUOTE_);
node_queue = G__158511;
ancestors = G__158512;
continue;
} else {
return ancestors;
}
break;
}
});
/**
 * Find successor nodes of node-id, node-id is included in the list. This will add
 *   branch nodes before run-next nodes. Returns a lazy sequence that traverse the graph
 *   as items are requested.
 */
com.wsscode.pathom3.connect.planner.node_successors = (function com$wsscode$pathom3$connect$planner$node_successors(graph,node_id){
var successors = com.wsscode.pathom3.connect.planner.find_direct_node_successors(com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,node_id));
if(cljs.core.seq(successors)){
return (new cljs.core.LazySeq(null,(function (){
return cljs.core.cons(node_id,cljs.core.apply.cljs$core$IFn$_invoke$arity$2(cljs.core.concat,cljs.core.map.cljs$core$IFn$_invoke$arity$2((function (p1__158312_SHARP_){
return (com.wsscode.pathom3.connect.planner.node_successors.cljs$core$IFn$_invoke$arity$2 ? com.wsscode.pathom3.connect.planner.node_successors.cljs$core$IFn$_invoke$arity$2(graph,p1__158312_SHARP_) : com.wsscode.pathom3.connect.planner.node_successors.call(null,graph,p1__158312_SHARP_));
}),successors)));
}),null,null));
} else {
return (new cljs.core.LazySeq(null,(function (){
return new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [node_id], null);
}),null,null));

}
});
/**
 * Return descendants by walking the run-next
 */
com.wsscode.pathom3.connect.planner.find_run_next_descendants = (function com$wsscode$pathom3$connect$planner$find_run_next_descendants(graph,p__158313){
var map__158314 = p__158313;
var map__158314__$1 = cljs.core.__destructure_map(map__158314);
var node_id = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158314__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707));
var node = com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,node_id);
var descendants = new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [node], null);
var G__158316 = node;
var map__158317 = G__158316;
var map__158317__$1 = cljs.core.__destructure_map(map__158317);
var run_next = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158317__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-next","com.wsscode.pathom3.connect.planner/run-next",285457140));
var descendants__$1 = descendants;
var G__158316__$1 = G__158316;
while(true){
var descendants__$2 = descendants__$1;
var map__158319 = G__158316__$1;
var map__158319__$1 = cljs.core.__destructure_map(map__158319);
var run_next__$1 = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158319__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-next","com.wsscode.pathom3.connect.planner/run-next",285457140));
var temp__5751__auto__ = com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,run_next__$1);
if(cljs.core.truth_(temp__5751__auto__)){
var next = temp__5751__auto__;
var G__158513 = cljs.core.conj.cljs$core$IFn$_invoke$arity$2(descendants__$2,next);
var G__158514 = next;
descendants__$1 = G__158513;
G__158316__$1 = G__158514;
continue;
} else {
return descendants__$2;
}
break;
}
});
/**
 * Traverses all run-next still it reaches a leaf.
 */
com.wsscode.pathom3.connect.planner.find_leaf_node = (function com$wsscode$pathom3$connect$planner$find_leaf_node(graph,node){
new cljs.core.PersistentVector(null, 4, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","graph","com.wsscode.pathom3.connect.planner/graph",-1915509744),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node","com.wsscode.pathom3.connect.planner/node",325156565),com.fulcrologic.guardrails.core._EQ__GT_,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node","com.wsscode.pathom3.connect.planner/node",325156565)], null);

return cljs.core.peek(com.wsscode.pathom3.connect.planner.find_run_next_descendants(graph,node));
});
com.wsscode.pathom3.connect.planner.extend_attribute_sub_query = (function com$wsscode$pathom3$connect$planner$extend_attribute_sub_query(graph,attr,shape){
return cljs.core.update_in.cljs$core$IFn$_invoke$arity$4(graph,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","index-ast","com.wsscode.pathom3.connect.planner/index-ast",905845713),attr], null),com.wsscode.pathom3.format.eql.merge_ast_children,cljs.core.assoc.cljs$core$IFn$_invoke$arity$variadic(com.wsscode.pathom3.format.shape_descriptor.shape_descriptor__GT_ast(shape),new cljs.core.Keyword(null,"type","type",1174270348),new cljs.core.Keyword(null,"prop","prop",-515168332),cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([new cljs.core.Keyword(null,"key","key",-1516042587),attr,new cljs.core.Keyword(null,"dispatch-key","dispatch-key",733619510),attr], 0)));
});
/**
 * Given an environment, available data and shape, determines if the whole shape
 *   is reachable (including nested dependencies).
 */
com.wsscode.pathom3.connect.planner.shape_reachable_QMARK_ = (function com$wsscode$pathom3$connect$planner$shape_reachable_QMARK_(env,available,shape){
var missing = com.wsscode.pathom3.format.shape_descriptor.missing.cljs$core$IFn$_invoke$arity$2(available,shape);
if(cljs.core.seq(missing)){
var graph = (function (){var G__158321 = cljs.core.assoc.cljs$core$IFn$_invoke$arity$variadic(com.wsscode.pathom3.connect.planner.reset_env(env),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","available-data","com.wsscode.pathom3.connect.planner/available-data",727921292),available,cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([new cljs.core.Keyword("edn-query-language.ast","node","edn-query-language.ast/node",-1614840957),com.wsscode.pathom3.format.shape_descriptor.shape_descriptor__GT_ast(missing)], 0));
return (com.wsscode.pathom3.connect.planner.compute_run_graph.cljs$core$IFn$_invoke$arity$1 ? com.wsscode.pathom3.connect.planner.compute_run_graph.cljs$core$IFn$_invoke$arity$1(G__158321) : com.wsscode.pathom3.connect.planner.compute_run_graph.call(null,G__158321));
})();
return cljs.core.every_QMARK_((function (p__158322){
var vec__158323 = p__158322;
var attr = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158323,(0),null);
var sub = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158323,(1),null);
var temp__5751__auto__ = com.wsscode.pathom3.connect.planner.node_attribute_provides(graph,env,attr);
if(cljs.core.truth_(temp__5751__auto__)){
var nodes_subs = temp__5751__auto__;
if(cljs.core.seq(nodes_subs)){
return cljs.core.some((function (p1__158320_SHARP_){
return (com.wsscode.pathom3.connect.planner.shape_reachable_QMARK_.cljs$core$IFn$_invoke$arity$3 ? com.wsscode.pathom3.connect.planner.shape_reachable_QMARK_.cljs$core$IFn$_invoke$arity$3(env,p1__158320_SHARP_,sub) : com.wsscode.pathom3.connect.planner.shape_reachable_QMARK_.call(null,env,p1__158320_SHARP_,sub));
}),nodes_subs);
} else {
return true;
}
} else {
return null;
}
}),shape);
} else {
return true;
}
});
com.wsscode.pathom3.connect.planner.compute_attribute_nested_input_require = (function com$wsscode$pathom3$connect$planner$compute_attribute_nested_input_require(graph,env,attr,shape,nodes){
com.wsscode.pathom3.connect.planner.add_snapshot_BANG_(graph,env,new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),["Processing nested requirements ",cljs.core.pr_str.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([cljs.core.PersistentArrayMap.createAsIfByAssoc([attr,shape])], 0))].join('')], null));

var checked_nodes = cljs.core.into.cljs$core$IFn$_invoke$arity$3(cljs.core.PersistentVector.EMPTY,cljs.core.map.cljs$core$IFn$_invoke$arity$1((function (node){
var G__158326 = node;
if(com.wsscode.pathom3.connect.planner.shape_reachable_QMARK_(env,cljs.core.get.cljs$core$IFn$_invoke$arity$2(new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","provides","com.wsscode.pathom3.connect.operation/provides",541419618).cljs$core$IFn$_invoke$arity$1(node),attr),shape)){
return cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(G__158326,new cljs.core.Keyword(null,"valid-path?","valid-path?",-244388226),true);
} else {
return G__158326;
}
})),nodes);
if(cljs.core.truth_(cljs.core.some(new cljs.core.Keyword(null,"valid-path?","valid-path?",-244388226),checked_nodes))){
return com.wsscode.pathom3.connect.planner.extend_attribute_sub_query(cljs.core.reduce.cljs$core$IFn$_invoke$arity$3((function (g,p__158327){
var map__158328 = p__158327;
var map__158328__$1 = cljs.core.__destructure_map(map__158328);
var valid_path_QMARK_ = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158328__$1,new cljs.core.Keyword(null,"valid-path?","valid-path?",-244388226));
var node_id = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158328__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707));
if(cljs.core.not(valid_path_QMARK_)){
return com.wsscode.pathom3.connect.planner.assoc_node(g,node_id,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","invalid-node?","com.wsscode.pathom3.connect.planner/invalid-node?",-2034679756),true);
} else {
return g;
}
}),graph,checked_nodes),attr,shape);
} else {
return com.wsscode.pathom3.connect.planner.add_unreachable_path(cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(graph,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212)),env,cljs.core.PersistentArrayMap.createAsIfByAssoc([attr,shape]));
}
});
com.wsscode.pathom3.connect.planner.compute_attribute_dependency_graph = (function com$wsscode$pathom3$connect$planner$compute_attribute_dependency_graph(graph,p__158330,attr,shape){
var map__158331 = p__158330;
var map__158331__$1 = cljs.core.__destructure_map(map__158331);
var env = map__158331__$1;
var recursive_joins = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158331__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","recursive-joins","com.wsscode.pathom3.connect.planner/recursive-joins",-1936947108));
com.wsscode.pathom3.connect.planner.add_snapshot_BANG_(graph,env,new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),["Processing dependency ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.PersistentArrayMap.createAsIfByAssoc([attr,shape]))].join('')], null));

var graph_SINGLEQUOTE_ = (function (){var G__158332 = cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(graph,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212));
var G__158333 = cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(cljs.core.update.cljs$core$IFn$_invoke$arity$4(cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(env,new cljs.core.Keyword("com.wsscode.pathom3.attribute","attribute","com.wsscode.pathom3.attribute/attribute",1003469786)),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","attr-deps-trail","com.wsscode.pathom3.connect.planner/attr-deps-trail",-81376567),com.wsscode.misc.coll.sconj,new cljs.core.Keyword("com.wsscode.pathom3.attribute","attribute","com.wsscode.pathom3.attribute/attribute",1003469786).cljs$core$IFn$_invoke$arity$1(env)),new cljs.core.Keyword("edn-query-language.ast","node","edn-query-language.ast/node",-1614840957),new cljs.core.PersistentArrayMap(null, 3, [new cljs.core.Keyword(null,"type","type",1174270348),new cljs.core.Keyword(null,"prop","prop",-515168332),new cljs.core.Keyword(null,"key","key",-1516042587),attr,new cljs.core.Keyword(null,"dispatch-key","dispatch-key",733619510),attr], null));
return (com.wsscode.pathom3.connect.planner.compute_attribute_graph.cljs$core$IFn$_invoke$arity$2 ? com.wsscode.pathom3.connect.planner.compute_attribute_graph.cljs$core$IFn$_invoke$arity$2(G__158332,G__158333) : com.wsscode.pathom3.connect.planner.compute_attribute_graph.call(null,G__158332,G__158333));
})();
if(cljs.core.truth_(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212).cljs$core$IFn$_invoke$arity$1(graph_SINGLEQUOTE_))){
var nodes = cljs.core.mapv.cljs$core$IFn$_invoke$arity$2((function (p1__158329_SHARP_){
return com.wsscode.pathom3.connect.planner.node_with_resolver_config(graph_SINGLEQUOTE_,env,p1__158329_SHARP_);
}),cljs.core.get_in.cljs$core$IFn$_invoke$arity$2(graph_SINGLEQUOTE_,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","index-attrs","com.wsscode.pathom3.connect.planner/index-attrs",-2110590142),attr], null)));
var recur = cljs.core.get.cljs$core$IFn$_invoke$arity$2(recursive_joins,attr);
if(cljs.core.truth_(recur)){
return cljs.core.update_in.cljs$core$IFn$_invoke$arity$variadic(com.wsscode.pathom3.connect.planner.add_snapshot_BANG_(graph_SINGLEQUOTE_,env,new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),["Detected recursive nested dependency on ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(attr)].join('')], null)),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","index-ast","com.wsscode.pathom3.connect.planner/index-ast",905845713),attr], null),cljs.core.assoc,new cljs.core.Keyword(null,"type","type",1174270348),new cljs.core.Keyword(null,"join","join",-758861890),new cljs.core.Keyword(null,"key","key",-1516042587),cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([attr,new cljs.core.Keyword(null,"dispatch-key","dispatch-key",733619510),attr,new cljs.core.Keyword(null,"query","query",-1288509510),recur], 0));
} else {
if(cljs.core.seq(shape)){
return com.wsscode.pathom3.connect.planner.compute_attribute_nested_input_require(graph_SINGLEQUOTE_,env,attr,shape,nodes);
} else {
return graph_SINGLEQUOTE_;

}
}
} else {
return graph_SINGLEQUOTE_;
}
});
com.wsscode.pathom3.connect.planner.extend_available_attribute_nested = (function com$wsscode$pathom3$connect$planner$extend_available_attribute_nested(graph,p__158334,attr,shape){
var map__158335 = p__158334;
var map__158335__$1 = cljs.core.__destructure_map(map__158335);
var env = map__158335__$1;
var available_data = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158335__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","available-data","com.wsscode.pathom3.connect.planner/available-data",727921292));
if(com.wsscode.pathom3.connect.planner.shape_reachable_QMARK_(env,cljs.core.get.cljs$core$IFn$_invoke$arity$2(available_data,attr),shape)){
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [com.wsscode.pathom3.connect.planner.mark_attribute_process_sub_query(com.wsscode.pathom3.connect.planner.extend_attribute_sub_query(graph,attr,shape),new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword(null,"key","key",-1516042587),attr,new cljs.core.Keyword(null,"children","children",-940561982),cljs.core.PersistentVector.EMPTY], null)),true], null);
} else {
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [com.wsscode.pathom3.connect.planner.add_unreachable_path(graph,env,cljs.core.PersistentArrayMap.createAsIfByAssoc([attr,shape])),false], null);
}
});
/**
 * Find the runner symbol for a resolver, on normal resolvers that is the resolver symbol,
 *   but for foreign resolvers it uses its ::p.c.o/dynamic-name.
 */
com.wsscode.pathom3.connect.planner.runner_node_sym = (function com$wsscode$pathom3$connect$planner$runner_node_sym(env,resolver_name){
var resolver = com.wsscode.pathom3.connect.indexes.resolver_config(env,resolver_name);
var or__4223__auto__ = new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","dynamic-name","com.wsscode.pathom3.connect.operation/dynamic-name",1218566238).cljs$core$IFn$_invoke$arity$1(resolver);
if(cljs.core.truth_(or__4223__auto__)){
return or__4223__auto__;
} else {
return resolver_name;
}
});
com.wsscode.pathom3.connect.planner.compute_dynamic_resolver_nested_requirements_keep = (function com$wsscode$pathom3$connect$planner$compute_dynamic_resolver_nested_requirements_keep(p__158336){
var map__158337 = p__158336;
var map__158337__$1 = cljs.core.__destructure_map(map__158337);
var env = map__158337__$1;
var ast = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158337__$1,new cljs.core.Keyword("edn-query-language.ast","node","edn-query-language.ast/node",-1614840957));
var attribute = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158337__$1,new cljs.core.Keyword("com.wsscode.pathom3.attribute","attribute","com.wsscode.pathom3.attribute/attribute",1003469786));
var op_name = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158337__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049));
if(cljs.core.seq(new cljs.core.Keyword(null,"children","children",-940561982).cljs$core$IFn$_invoke$arity$1(ast))){
var config = com.wsscode.pathom3.connect.indexes.resolver_config(env,op_name);
var available = cljs.core.get_in.cljs$core$IFn$_invoke$arity$2(config,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","provides","com.wsscode.pathom3.connect.operation/provides",541419618),attribute], null));
var graph = (function (){var G__158338 = cljs.core.assoc.cljs$core$IFn$_invoke$arity$variadic(com.wsscode.pathom3.connect.planner.reset_env(env),new cljs.core.Keyword("edn-query-language.ast","node","edn-query-language.ast/node",-1614840957),ast,cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","available-data","com.wsscode.pathom3.connect.planner/available-data",727921292),available], 0));
return (com.wsscode.pathom3.connect.planner.compute_run_graph.cljs$core$IFn$_invoke$arity$1 ? com.wsscode.pathom3.connect.planner.compute_run_graph.cljs$core$IFn$_invoke$arity$1(G__158338) : com.wsscode.pathom3.connect.planner.compute_run_graph.call(null,G__158338));
})();
var node_inputs = cljs.core.reduce.cljs$core$IFn$_invoke$arity$3((function (i,p__158339){
var map__158340 = p__158339;
var map__158340__$1 = cljs.core.__destructure_map(map__158340);
var input = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158340__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","input","com.wsscode.pathom3.connect.planner/input",1912157524));
return com.wsscode.pathom3.format.shape_descriptor.merge_shapes.cljs$core$IFn$_invoke$arity$2(i,input);
}),cljs.core.PersistentArrayMap.EMPTY,cljs.core.vals(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","nodes","com.wsscode.pathom3.connect.planner/nodes",873592574).cljs$core$IFn$_invoke$arity$1(graph)));
var ast_shape = com.wsscode.pathom3.format.shape_descriptor.ast__GT_shape_descriptor(ast);
return com.wsscode.pathom3.format.shape_descriptor.intersection(available,com.wsscode.pathom3.format.shape_descriptor.merge_shapes.cljs$core$IFn$_invoke$arity$2(node_inputs,ast_shape));
} else {
return null;
}
});
/**
 * Create a new node representative to run a given resolver.
 */
com.wsscode.pathom3.connect.planner.create_node_for_resolver_call = (function com$wsscode$pathom3$connect$planner$create_node_for_resolver_call(p__158341){
var map__158342 = p__158341;
var map__158342__$1 = cljs.core.__destructure_map(map__158342);
var env = map__158342__$1;
var ast = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158342__$1,new cljs.core.Keyword("edn-query-language.ast","node","edn-query-language.ast/node",-1614840957));
var input = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158342__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","input","com.wsscode.pathom3.connect.planner/input",1912157524));
var attribute = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158342__$1,new cljs.core.Keyword("com.wsscode.pathom3.attribute","attribute","com.wsscode.pathom3.attribute/attribute",1003469786));
var op_name = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158342__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049));
var ast_params = new cljs.core.Keyword(null,"params","params",710516235).cljs$core$IFn$_invoke$arity$1(ast);
var config = com.wsscode.pathom3.connect.indexes.resolver_config(env,op_name);
var op_name_SINGLEQUOTE_ = (function (){var or__4223__auto__ = new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","dynamic-name","com.wsscode.pathom3.connect.operation/dynamic-name",1218566238).cljs$core$IFn$_invoke$arity$1(config);
if(cljs.core.truth_(or__4223__auto__)){
return or__4223__auto__;
} else {
return op_name;
}
})();
var dynamic_QMARK_ = com.wsscode.pathom3.connect.indexes.dynamic_resolver_QMARK_(env,op_name_SINGLEQUOTE_);
var sub = (cljs.core.truth_(dynamic_QMARK_)?com.wsscode.pathom3.connect.planner.compute_dynamic_resolver_nested_requirements_keep(env):null);
var requires = cljs.core.PersistentArrayMap.createAsIfByAssoc([attribute,(function (){var or__4223__auto__ = sub;
if(cljs.core.truth_(or__4223__auto__)){
return or__4223__auto__;
} else {
return cljs.core.PersistentArrayMap.EMPTY;
}
})()]);
var G__158343 = com.wsscode.pathom3.connect.planner.new_node(env,new cljs.core.PersistentArrayMap(null, 3, [new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049),op_name_SINGLEQUOTE_,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","expects","com.wsscode.pathom3.connect.planner/expects",2018136040),requires,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","input","com.wsscode.pathom3.connect.planner/input",1912157524),input], null));
var G__158343__$1 = ((cljs.core.seq(ast_params))?cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(G__158343,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","params","com.wsscode.pathom3.connect.planner/params",1545394210),ast_params):G__158343);
if(cljs.core.truth_(dynamic_QMARK_)){
return cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(G__158343__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","foreign-ast","com.wsscode.pathom3.connect.planner/foreign-ast",1579399548),new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword(null,"type","type",1174270348),new cljs.core.Keyword(null,"root","root",-448657453),new cljs.core.Keyword(null,"children","children",-940561982),(cljs.core.truth_(sub)?(function (){var ast_SINGLEQUOTE_ = com.wsscode.pathom3.format.shape_descriptor.shape_descriptor__GT_ast(sub);
return new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.assoc.cljs$core$IFn$_invoke$arity$variadic(ast,new cljs.core.Keyword(null,"children","children",-940561982),new cljs.core.Keyword(null,"children","children",-940561982).cljs$core$IFn$_invoke$arity$1(ast_SINGLEQUOTE_),cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([new cljs.core.Keyword(null,"query","query",-1288509510),edn_query_language.core.ast__GT_query(ast_SINGLEQUOTE_)], 0))], null);
})():new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [ast], null))], null));
} else {
return G__158343__$1;
}
});
/**
 * For a set of resolvers (the R part of OIR index), create one OR node that branches
 *   to each option in the set.
 */
com.wsscode.pathom3.connect.planner.compute_resolver_leaf = (function com$wsscode$pathom3$connect$planner$compute_resolver_leaf(graph,p__158347,resolvers){
var map__158348 = p__158347;
var map__158348__$1 = cljs.core.__destructure_map(map__158348);
var env = map__158348__$1;
var input = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158348__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","input","com.wsscode.pathom3.connect.planner/input",1912157524));
var resolver_nodes = cljs.core.into.cljs$core$IFn$_invoke$arity$3(cljs.core.List.EMPTY,cljs.core.map.cljs$core$IFn$_invoke$arity$1((function (p1__158344_SHARP_){
return com.wsscode.pathom3.connect.planner.create_node_for_resolver_call(cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(env,new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049),p1__158344_SHARP_));
})),resolvers);
if(cljs.core.seq(resolver_nodes)){
var _LT__GT_ = com.wsscode.pathom3.connect.planner.create_root_or(cljs.core.reduce.cljs$core$IFn$_invoke$arity$3((function (p1__158345_SHARP_,p2__158346_SHARP_){
return com.wsscode.pathom3.connect.planner.set_node_source_for_attrs.cljs$core$IFn$_invoke$arity$3(com.wsscode.pathom3.connect.planner.include_node(p1__158345_SHARP_,p2__158346_SHARP_),env,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707).cljs$core$IFn$_invoke$arity$1(p2__158346_SHARP_));
}),graph,resolver_nodes),env,cljs.core.mapv.cljs$core$IFn$_invoke$arity$2(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707),resolver_nodes));
return com.wsscode.pathom3.connect.planner.add_snapshot_BANG_(_LT__GT_,env,new cljs.core.PersistentArrayMap(null, 3, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),["Add nodes for input path ",cljs.core.pr_str.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([input], 0))].join(''),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","highlight-nodes","com.wsscode.pathom3.connect.planner/highlight-nodes",-1697917026),cljs.core.into.cljs$core$IFn$_invoke$arity$3(cljs.core.PersistentHashSet.createAsIfByAssoc([new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212).cljs$core$IFn$_invoke$arity$1(_LT__GT_)]),cljs.core.map.cljs$core$IFn$_invoke$arity$1(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707)),resolver_nodes),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","highlight-styles","com.wsscode.pathom3.connect.planner/highlight-styles",1086922280),cljs.core.PersistentArrayMap.createAsIfByAssoc([new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212).cljs$core$IFn$_invoke$arity$1(_LT__GT_),(1)])], null));
} else {
return com.wsscode.pathom3.connect.planner.add_snapshot_BANG_(graph,env,new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),"No reachable resolver found."], null));
}
});
/**
 * Merge the optionals from a collection of resolver symbols.
 */
com.wsscode.pathom3.connect.planner.resolvers_missing_optionals = (function com$wsscode$pathom3$connect$planner$resolvers_missing_optionals(p__158350,resolvers){
var map__158351 = p__158350;
var map__158351__$1 = cljs.core.__destructure_map(map__158351);
var env = map__158351__$1;
var available_data = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158351__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","available-data","com.wsscode.pathom3.connect.planner/available-data",727921292));
return com.wsscode.pathom3.format.shape_descriptor.missing.cljs$core$IFn$_invoke$arity$2(available_data,cljs.core.transduce.cljs$core$IFn$_invoke$arity$4(cljs.core.map.cljs$core$IFn$_invoke$arity$1((function (p1__158349_SHARP_){
return com.wsscode.pathom3.connect.indexes.resolver_optionals(env,p1__158349_SHARP_);
})),com.wsscode.pathom3.format.shape_descriptor.merge_shapes,cljs.core.PersistentArrayMap.EMPTY,resolvers));
});
com.wsscode.pathom3.connect.planner.compute_missing_chain_deps = (function com$wsscode$pathom3$connect$planner$compute_missing_chain_deps(graph,p__158352,missing){
var map__158353 = p__158352;
var map__158353__$1 = cljs.core.__destructure_map(map__158353);
var env = map__158353__$1;
var available_data = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158353__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","available-data","com.wsscode.pathom3.connect.planner/available-data",727921292));
return cljs.core.reduce_kv((function (p__158354,attr,shape){
var vec__158355 = p__158354;
var graph__$1 = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158355,(0),null);
var node_map = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158355,(1),null);
if(cljs.core.contains_QMARK_(available_data,attr)){
var vec__158358 = com.wsscode.pathom3.connect.planner.extend_available_attribute_nested(graph__$1,env,attr,shape);
var graph_SINGLEQUOTE_ = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158358,(0),null);
var extended_QMARK_ = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158358,(1),null);
if(cljs.core.truth_(extended_QMARK_)){
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [graph_SINGLEQUOTE_,node_map], null);
} else {
return cljs.core.reduced(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [graph_SINGLEQUOTE_,null], null));
}
} else {
var graph_SINGLEQUOTE_ = com.wsscode.pathom3.connect.planner.compute_attribute_dependency_graph(graph__$1,env,attr,shape);
var temp__5751__auto__ = new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212).cljs$core$IFn$_invoke$arity$1(graph_SINGLEQUOTE_);
if(cljs.core.truth_(temp__5751__auto__)){
var root = temp__5751__auto__;
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [graph_SINGLEQUOTE_,cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(node_map,attr,root)], null);
} else {
return cljs.core.reduced(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [com.wsscode.pathom3.connect.planner.merge_unreachable.cljs$core$IFn$_invoke$arity$2(graph__$1,graph_SINGLEQUOTE_),null], null));
}
}
}),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [graph,cljs.core.PersistentArrayMap.EMPTY], null),missing);
});
com.wsscode.pathom3.connect.planner.compute_missing_chain_optional_deps = (function com$wsscode$pathom3$connect$planner$compute_missing_chain_optional_deps(graph,p__158361,opt_missing,node_map){
var map__158362 = p__158361;
var map__158362__$1 = cljs.core.__destructure_map(map__158362);
var env = map__158362__$1;
var available_data = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158362__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","available-data","com.wsscode.pathom3.connect.planner/available-data",727921292));
return cljs.core.reduce_kv((function (p__158363,attr,shape){
var vec__158364 = p__158363;
var graph__$1 = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158364,(0),null);
var node_map__$1 = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158364,(1),null);
if(cljs.core.contains_QMARK_(available_data,attr)){
var vec__158367 = com.wsscode.pathom3.connect.planner.extend_available_attribute_nested(graph__$1,env,attr,shape);
var graph_SINGLEQUOTE_ = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158367,(0),null);
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [graph_SINGLEQUOTE_,node_map__$1], null);
} else {
var graph_SINGLEQUOTE_ = com.wsscode.pathom3.connect.planner.compute_attribute_dependency_graph(graph__$1,env,attr,shape);
var temp__5751__auto__ = new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212).cljs$core$IFn$_invoke$arity$1(graph_SINGLEQUOTE_);
if(cljs.core.truth_(temp__5751__auto__)){
var root = temp__5751__auto__;
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [(function (){var G__158370 = graph_SINGLEQUOTE_;
if(cljs.core.contains_QMARK_(node_map__$1,attr)){
return com.wsscode.pathom3.connect.planner.add_snapshot_BANG_(com.wsscode.pathom3.connect.planner.remove_root_node_cluster(G__158370,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.get.cljs$core$IFn$_invoke$arity$2(node_map__$1,attr)], null)),env,new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),"Optional computation overrode the required."], null));
} else {
return G__158370;
}
})(),cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(node_map__$1,attr,root)], null);
} else {
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [com.wsscode.pathom3.connect.planner.merge_unreachable.cljs$core$IFn$_invoke$arity$2(graph__$1,graph_SINGLEQUOTE_),node_map__$1], null);
}
}
}),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [graph,node_map], null),opt_missing);
});
com.wsscode.pathom3.connect.planner.index_recursive_joins = (function com$wsscode$pathom3$connect$planner$index_recursive_joins(env,resolvers){
return cljs.core.into.cljs$core$IFn$_invoke$arity$3(cljs.core.PersistentArrayMap.EMPTY,cljs.core.comp.cljs$core$IFn$_invoke$arity$3(cljs.core.map.cljs$core$IFn$_invoke$arity$1((function (p1__158371_SHARP_){
return com.wsscode.pathom3.connect.indexes.resolver_config(env,p1__158371_SHARP_);
})),cljs.core.mapcat.cljs$core$IFn$_invoke$arity$1(new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","input","com.wsscode.pathom3.connect.operation/input",-1553849497)),cljs.core.keep.cljs$core$IFn$_invoke$arity$1((function (x){
if(((cljs.core.map_QMARK_(x)) && (com.wsscode.pathom3.format.eql.recursive_query_QMARK_(cljs.core.first(cljs.core.vals(x)))))){
return cljs.core.first(x);
} else {
return null;
}
}))),resolvers);
});
/**
 * Start a recursive call to process the dependencies required by the resolver.
 */
com.wsscode.pathom3.connect.planner.compute_missing_chain = (function com$wsscode$pathom3$connect$planner$compute_missing_chain(graph,env,missing,missing_optionals){
var _ = com.wsscode.pathom3.connect.planner.add_snapshot_BANG_(graph,env,new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),["Computing ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(new cljs.core.Keyword("com.wsscode.pathom3.attribute","attribute","com.wsscode.pathom3.attribute/attribute",1003469786).cljs$core$IFn$_invoke$arity$1(env))," dependencies: ",cljs.core.pr_str.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([missing], 0))].join('')], null));
var vec__158372 = com.wsscode.pathom3.connect.planner.compute_missing_chain_deps(graph,env,missing);
var graph_SINGLEQUOTE_ = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158372,(0),null);
var node_map = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158372,(1),null);
if((!((node_map == null)))){
var vec__158375 = com.wsscode.pathom3.connect.planner.compute_missing_chain_optional_deps(graph_SINGLEQUOTE_,env,missing_optionals,node_map);
var graph_SINGLEQUOTE__SINGLEQUOTE_ = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158375,(0),null);
var node_map_opts = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158375,(1),null);
var all_nodes = cljs.core.vals(cljs.core.merge.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([node_map,node_map_opts], 0)));
var _LT__GT_ = (function (){var G__158378 = graph_SINGLEQUOTE__SINGLEQUOTE_;
var G__158378__$1 = ((cljs.core.seq(all_nodes))?com.wsscode.pathom3.connect.planner.create_root_and(G__158378,env,cljs.core.vals(cljs.core.merge.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([node_map,node_map_opts], 0)))):G__158378);
if(cljs.core.empty_QMARK_(all_nodes)){
return com.wsscode.pathom3.connect.planner.set_root_node(G__158378__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212).cljs$core$IFn$_invoke$arity$1(graph));
} else {
return G__158378__$1;
}
})();
return com.wsscode.pathom3.connect.planner.add_snapshot_BANG_(_LT__GT_,env,new cljs.core.PersistentArrayMap(null, 4, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-event","com.wsscode.pathom3.connect.planner/snapshot-event",-122347979),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","compute-missing-success","com.wsscode.pathom3.connect.planner/compute-missing-success",1845372101),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),["Complete computing deps ",cljs.core.pr_str.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([missing], 0))].join(''),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","highlight-nodes","com.wsscode.pathom3.connect.planner/highlight-nodes",-1697917026),cljs.core.into.cljs$core$IFn$_invoke$arity$2(cljs.core.PersistentHashSet.createAsIfByAssoc([new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212).cljs$core$IFn$_invoke$arity$1(_LT__GT_)]),cljs.core.vals(node_map)),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","highlight-styles","com.wsscode.pathom3.connect.planner/highlight-styles",1086922280),cljs.core.PersistentArrayMap.createAsIfByAssoc([new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212).cljs$core$IFn$_invoke$arity$1(_LT__GT_),(1)])], null));
} else {
return com.wsscode.pathom3.connect.planner.add_snapshot_BANG_(com.wsscode.pathom3.connect.planner.merge_unreachable.cljs$core$IFn$_invoke$arity$2(cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(graph,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212)),graph_SINGLEQUOTE_),env,new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-event","com.wsscode.pathom3.connect.planner/snapshot-event",-122347979),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","compute-missing-failed","com.wsscode.pathom3.connect.planner/compute-missing-failed",2096505951),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),["Failed to compute dependencies ",cljs.core.pr_str.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([missing], 0))].join('')], null));
}
});
/**
 * This function computes the graph for a given `process path`. It creates the resolver
 *   nodes to execute the resolvers, in case of many resolvers it uses a OR node to combine
 *   them.
 * 
 *   Them it fetches the dependencies, declared in the process path. If the dependencies
 *   are successfully computed, it returns the graph with the root on the node that
 *   fulfills the request.
 */
com.wsscode.pathom3.connect.planner.compute_input_resolvers_graph = (function com$wsscode$pathom3$connect$planner$compute_input_resolvers_graph(graph,p__158380,input,resolvers){
var map__158381 = p__158380;
var map__158381__$1 = cljs.core.__destructure_map(map__158381);
var env = map__158381__$1;
var available_data = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158381__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","available-data","com.wsscode.pathom3.connect.planner/available-data",727921292));
var attribute = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158381__$1,new cljs.core.Keyword("com.wsscode.pathom3.attribute","attribute","com.wsscode.pathom3.attribute/attribute",1003469786));
if(cljs.core.contains_QMARK_(input,attribute)){
return graph;
} else {
var missing = com.wsscode.pathom3.format.shape_descriptor.missing.cljs$core$IFn$_invoke$arity$2(available_data,input);
var missing_opts = com.wsscode.pathom3.connect.planner.resolvers_missing_optionals(env,resolvers);
var env__$1 = cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(env,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","input","com.wsscode.pathom3.connect.planner/input",1912157524),input);
var map__158382 = com.wsscode.pathom3.connect.planner.compute_resolver_leaf(graph,env__$1,resolvers);
var map__158382__$1 = cljs.core.__destructure_map(map__158382);
var graph_SINGLEQUOTE_ = map__158382__$1;
var leaf_root = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158382__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212));
if(cljs.core.truth_(leaf_root)){
if(cljs.core.seq(cljs.core.merge.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([missing,missing_opts], 0)))){
var graph_with_deps = com.wsscode.pathom3.connect.planner.compute_missing_chain(graph_SINGLEQUOTE_,cljs.core.update.cljs$core$IFn$_invoke$arity$3(cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(env__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","recursive-joins","com.wsscode.pathom3.connect.planner/recursive-joins",-1936947108),com.wsscode.pathom3.connect.planner.index_recursive_joins(env__$1,resolvers)),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-depth","com.wsscode.pathom3.connect.planner/snapshot-depth",1034256870),(function (p1__158379_SHARP_){
return ((function (){var or__4223__auto__ = p1__158379_SHARP_;
if(cljs.core.truth_(or__4223__auto__)){
return or__4223__auto__;
} else {
return (0);
}
})() + (1));
})),missing,missing_opts);
if(cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212).cljs$core$IFn$_invoke$arity$1(graph_with_deps),leaf_root)){
return com.wsscode.pathom3.connect.planner.add_snapshot_BANG_(graph_with_deps,env__$1,new cljs.core.PersistentArrayMap(null, 3, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-event","com.wsscode.pathom3.connect.planner/snapshot-event",-122347979),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-chained-no-nodes","com.wsscode.pathom3.connect.planner/snapshot-chained-no-nodes",369295509),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),"Chained deps without adding nodes",new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","highlight-nodes","com.wsscode.pathom3.connect.planner/highlight-nodes",-1697917026),cljs.core.PersistentHashSet.createAsIfByAssoc([leaf_root])], null));
} else {
if(cljs.core.truth_(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212).cljs$core$IFn$_invoke$arity$1(graph_with_deps))){
var tail_node_id = new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","node-id","com.wsscode.pathom3.connect.planner/node-id",1696523707).cljs$core$IFn$_invoke$arity$1(com.wsscode.pathom3.connect.planner.find_leaf_node(graph_with_deps,com.wsscode.pathom3.connect.planner.get_root_node(graph_with_deps)));
return com.wsscode.pathom3.connect.planner.add_snapshot_BANG_(com.wsscode.pathom3.connect.planner.set_node_run_next.cljs$core$IFn$_invoke$arity$3(graph_with_deps,tail_node_id,leaf_root),env__$1,new cljs.core.PersistentArrayMap(null, 3, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-event","com.wsscode.pathom3.connect.planner/snapshot-event",-122347979),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-chained-dependencies","com.wsscode.pathom3.connect.planner/snapshot-chained-dependencies",573974212),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),"Chained deps",new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","highlight-nodes","com.wsscode.pathom3.connect.planner/highlight-nodes",-1697917026),cljs.core.into.cljs$core$IFn$_invoke$arity$2(cljs.core.PersistentHashSet.EMPTY,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [tail_node_id,leaf_root], null))], null));
} else {
return com.wsscode.pathom3.connect.planner.merge_unreachable.cljs$core$IFn$_invoke$arity$2(graph,graph_with_deps);

}
}
} else {
return graph_SINGLEQUOTE_;
}
} else {
return graph;
}
}
});
/**
 * Traverse the attribute options, for example, considering we are processing the
 *   attribute `:a`. And we have this index:
 * 
 *    {::pci/index-oir {:a {{} #{a}}}}
 * 
 *   This means we are now at the `{{} #{a}}` part, lets call each entry of this map a
 *   `process path`.
 * 
 *   To break it down, in this case we have one `process path` to get `:a`. Each process
 *   pair contains an input shape and a set of resolvers.
 * 
 *   You can read it as: I can fetch `:a` providing the data `{}` to the resolver `a`.
 * 
 *   A bigger example:
 * 
 *    {::pci/index-oir {:a {{:b {}} #{a-from-b}
 *                          {:c {}} #{a-from-c a-f-c}}}}
 * 
 *   In this case we have two process paths.
 * 
 *   This function iterates over each process path, if at least one can complete the path,
 *   it returns a graph with a root o the node. In case of many options, an OR node will
 *   be the root, providing each path.
 */
com.wsscode.pathom3.connect.planner.compute_attribute_graph_STAR_ = (function com$wsscode$pathom3$connect$planner$compute_attribute_graph_STAR_(graph,p__158383){
var map__158384 = p__158383;
var map__158384__$1 = cljs.core.__destructure_map(map__158384);
var env = map__158384__$1;
var index_oir = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158384__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.indexes","index-oir","com.wsscode.pathom3.connect.indexes/index-oir",-418434909));
var attribute = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158384__$1,new cljs.core.Keyword("com.wsscode.pathom3.attribute","attribute","com.wsscode.pathom3.attribute/attribute",1003469786));
var graph__$1 = com.wsscode.pathom3.connect.planner.add_snapshot_BANG_(graph,env,new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-event","com.wsscode.pathom3.connect.planner/snapshot-event",-122347979),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-process-attribute","com.wsscode.pathom3.connect.planner/snapshot-process-attribute",-1867107939),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),["Process attribute ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(attribute)].join('')], null));
var vec__158385 = cljs.core.reduce_kv((function (p__158388,input,resolvers){
var vec__158389 = p__158388;
var graph__$2 = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158389,(0),null);
var nodes = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158389,(1),null);
var unreachable_graphs = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158389,(2),null);
var graph_SINGLEQUOTE_ = com.wsscode.pathom3.connect.planner.compute_input_resolvers_graph(cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(graph__$2,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212)),env,input,resolvers);
if(cljs.core.truth_(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212).cljs$core$IFn$_invoke$arity$1(graph_SINGLEQUOTE_))){
return new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [graph_SINGLEQUOTE_,cljs.core.conj.cljs$core$IFn$_invoke$arity$2(nodes,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212).cljs$core$IFn$_invoke$arity$1(graph_SINGLEQUOTE_)),unreachable_graphs], null);
} else {
return new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [graph__$2,nodes,cljs.core.conj.cljs$core$IFn$_invoke$arity$2(unreachable_graphs,graph_SINGLEQUOTE_)], null);
}
}),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [graph__$1,cljs.core.PersistentHashSet.EMPTY,cljs.core.PersistentHashSet.EMPTY], null),cljs.core.get.cljs$core$IFn$_invoke$arity$2(index_oir,attribute));
var graph_SINGLEQUOTE_ = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158385,(0),null);
var node_ids = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158385,(1),null);
var unreachable_graphs = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158385,(2),null);
if(cljs.core.seq(node_ids)){
return com.wsscode.pathom3.connect.planner.create_root_or(graph_SINGLEQUOTE_,env,node_ids);
} else {
var _LT__GT_ = com.wsscode.pathom3.connect.planner.add_unreachable_path(graph__$1,env,cljs.core.PersistentArrayMap.createAsIfByAssoc([attribute,cljs.core.PersistentArrayMap.EMPTY]));
return cljs.core.reduce.cljs$core$IFn$_invoke$arity$3(com.wsscode.pathom3.connect.planner.merge_unreachable,_LT__GT_,unreachable_graphs);
}
});
/**
 * Compute the run graph for a given attribute.
 */
com.wsscode.pathom3.connect.planner.compute_attribute_graph = (function com$wsscode$pathom3$connect$planner$compute_attribute_graph(p__158392,p__158393){
var map__158394 = p__158392;
var map__158394__$1 = cljs.core.__destructure_map(map__158394);
var graph = map__158394__$1;
var unreachable_paths = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158394__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","unreachable-paths","com.wsscode.pathom3.connect.planner/unreachable-paths",614064297));
var map__158395 = p__158393;
var map__158395__$1 = cljs.core.__destructure_map(map__158395);
var env = map__158395__$1;
var map__158396 = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158395__$1,new cljs.core.Keyword("edn-query-language.ast","node","edn-query-language.ast/node",-1614840957));
var map__158396__$1 = cljs.core.__destructure_map(map__158396);
var attr = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158396__$1,new cljs.core.Keyword(null,"key","key",-1516042587));
var attr_deps_trail = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158395__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","attr-deps-trail","com.wsscode.pathom3.connect.planner/attr-deps-trail",-81376567));
var index_oir = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158395__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.indexes","index-oir","com.wsscode.pathom3.connect.indexes/index-oir",-418434909));
var env__$1 = cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(env,new cljs.core.Keyword("com.wsscode.pathom3.attribute","attribute","com.wsscode.pathom3.attribute/attribute",1003469786),attr);
if(cljs.core.contains_QMARK_(unreachable_paths,attr)){
return com.wsscode.pathom3.connect.planner.add_snapshot_BANG_(graph,env__$1,new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-event","com.wsscode.pathom3.connect.planner/snapshot-event",-122347979),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-attribute-unreachable","com.wsscode.pathom3.connect.planner/snapshot-attribute-unreachable",-974827819),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),["Attribute unreachable ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(attr)].join('')], null));
} else {
if(cljs.core.contains_QMARK_(attr_deps_trail,attr)){
return com.wsscode.pathom3.connect.planner.add_snapshot_BANG_(graph,env__$1,new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-event","com.wsscode.pathom3.connect.planner/snapshot-event",-122347979),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-attribute-cycle-dependency","com.wsscode.pathom3.connect.planner/snapshot-attribute-cycle-dependency",-2139400464),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),["Attribute cycle detected for ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(attr)].join('')], null));
} else {
if(cljs.core.contains_QMARK_(index_oir,attr)){
return com.wsscode.pathom3.connect.planner.compute_attribute_graph_STAR_(graph,env__$1);
} else {
return com.wsscode.pathom3.connect.planner.add_unreachable_path(graph,env__$1,cljs.core.PersistentArrayMap.createAsIfByAssoc([attr,cljs.core.PersistentArrayMap.EMPTY]));

}
}
}
});
/**
 * This function deals with attributes that are not part of the index execution. The
 *   cases here are:
 * 
 *   - EQL idents
 *   - Previously available data
 *   - Placeholders
 */
com.wsscode.pathom3.connect.planner.compute_non_index_attribute = (function com$wsscode$pathom3$connect$planner$compute_non_index_attribute(graph,p__158397){
var map__158398 = p__158397;
var map__158398__$1 = cljs.core.__destructure_map(map__158398);
var env = map__158398__$1;
var map__158399 = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158398__$1,new cljs.core.Keyword("edn-query-language.ast","node","edn-query-language.ast/node",-1614840957));
var map__158399__$1 = cljs.core.__destructure_map(map__158399);
var ast = map__158399__$1;
var attr = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158399__$1,new cljs.core.Keyword(null,"key","key",-1516042587));
var available_data = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158398__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","available-data","com.wsscode.pathom3.connect.planner/available-data",727921292));
if(edn_query_language.core.ident_QMARK_(attr)){
return com.wsscode.pathom3.connect.planner.add_snapshot_BANG_(com.wsscode.pathom3.connect.planner.add_ident_process(graph,ast),env,new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-event","com.wsscode.pathom3.connect.planner/snapshot-event",-122347979),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-add-ident-process","com.wsscode.pathom3.connect.planner/snapshot-add-ident-process",-1538347931),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),["Add ident process for ",cljs.core.pr_str.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([attr], 0))].join('')], null));
} else {
if(cljs.core.contains_QMARK_(available_data,attr)){
return com.wsscode.pathom3.connect.planner.add_snapshot_BANG_(com.wsscode.pathom3.connect.planner.mark_attribute_process_sub_query(graph,ast),env,new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-event","com.wsscode.pathom3.connect.planner/snapshot-event",-122347979),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-attribute-already-available","com.wsscode.pathom3.connect.planner/snapshot-attribute-already-available",-1865514315),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),["Attribute already available ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(attr)].join('')], null));
} else {
if(com.wsscode.pathom3.placeholder.placeholder_key_QMARK_(env,attr)){
var G__158400 = com.wsscode.pathom3.connect.planner.add_placeholder_entry(graph,attr);
var G__158401 = env;
return (com.wsscode.pathom3.connect.planner.compute_run_graph_STAR_.cljs$core$IFn$_invoke$arity$2 ? com.wsscode.pathom3.connect.planner.compute_run_graph_STAR_.cljs$core$IFn$_invoke$arity$2(G__158400,G__158401) : com.wsscode.pathom3.connect.planner.compute_run_graph_STAR_.call(null,G__158400,G__158401));
} else {
return null;
}
}
}
});
/**
 * Starts scanning the AST to plan for each attribute.
 */
com.wsscode.pathom3.connect.planner.compute_run_graph_STAR_ = (function com$wsscode$pathom3$connect$planner$compute_run_graph_STAR_(graph,env){
var vec__158402 = cljs.core.reduce.cljs$core$IFn$_invoke$arity$3((function (p__158405,ast){
var vec__158406 = p__158405;
var graph__$1 = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158406,(0),null);
var node_ids = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158406,(1),null);
if(cljs.core.contains_QMARK_(new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword(null,"prop","prop",-515168332),null,new cljs.core.Keyword(null,"join","join",-758861890),null], null), null),new cljs.core.Keyword(null,"type","type",1174270348).cljs$core$IFn$_invoke$arity$1(ast))){
var env__$1 = cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(env,new cljs.core.Keyword("edn-query-language.ast","node","edn-query-language.ast/node",-1614840957),ast);
var or__4223__auto__ = (function (){var temp__5751__auto__ = com.wsscode.pathom3.connect.planner.compute_non_index_attribute(graph__$1,env__$1);
if(cljs.core.truth_(temp__5751__auto__)){
var map__158409 = temp__5751__auto__;
var map__158409__$1 = cljs.core.__destructure_map(map__158409);
var graph_SINGLEQUOTE_ = map__158409__$1;
var root = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158409__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212));
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [graph_SINGLEQUOTE_,(function (){var G__158410 = node_ids;
if(cljs.core.truth_(root)){
return cljs.core.conj.cljs$core$IFn$_invoke$arity$2(G__158410,root);
} else {
return G__158410;
}
})()], null);
} else {
return null;
}
})();
if(cljs.core.truth_(or__4223__auto__)){
return or__4223__auto__;
} else {
var map__158411 = com.wsscode.pathom3.connect.planner.compute_attribute_graph(graph__$1,cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(env__$1,new cljs.core.Keyword("edn-query-language.ast","node","edn-query-language.ast/node",-1614840957),ast));
var map__158411__$1 = cljs.core.__destructure_map(map__158411);
var graph_SINGLEQUOTE_ = map__158411__$1;
var root = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158411__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212));
if(cljs.core.truth_(root)){
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [graph_SINGLEQUOTE_,cljs.core.conj.cljs$core$IFn$_invoke$arity$2(node_ids,root)], null);
} else {
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [com.wsscode.pathom3.connect.planner.merge_unreachable.cljs$core$IFn$_invoke$arity$2(graph__$1,graph_SINGLEQUOTE_),node_ids], null);
}
}
} else {
if(com.wsscode.misc.refs.kw_identical_QMARK_(new cljs.core.Keyword(null,"type","type",1174270348).cljs$core$IFn$_invoke$arity$1(ast),new cljs.core.Keyword(null,"call","call",-519999866))){
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.update.cljs$core$IFn$_invoke$arity$4(graph__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","mutations","com.wsscode.pathom3.connect.planner/mutations",-1571107042),com.wsscode.misc.coll.vconj,new cljs.core.Keyword(null,"key","key",-1516042587).cljs$core$IFn$_invoke$arity$1(ast)),node_ids], null);
} else {
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [graph__$1,node_ids], null);

}
}
}),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [graph,cljs.core.PersistentHashSet.EMPTY], null),new cljs.core.Keyword(null,"children","children",-940561982).cljs$core$IFn$_invoke$arity$1(new cljs.core.Keyword("edn-query-language.ast","node","edn-query-language.ast/node",-1614840957).cljs$core$IFn$_invoke$arity$1(env)));
var graph_SINGLEQUOTE_ = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158402,(0),null);
var node_ids = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158402,(1),null);
if(cljs.core.seq(node_ids)){
return com.wsscode.pathom3.connect.planner.create_root_and(graph_SINGLEQUOTE_,env,node_ids);
} else {
return graph_SINGLEQUOTE_;
}
});
/**
 * Generates a run plan for a given environment, the environment should contain the
 *   indexes in it (::pc/index-oir and ::pc/index-resolvers). It computes a plan to execute
 *   one level of an AST, the AST must be provided via the key :edn-query-language.ast/node.
 * 
 *    (compute-run-graph (assoc indexes :edn-query-language.ast/node ...))
 * 
 *   The resulting graph will look like this:
 * 
 *    {::nodes                 {1 {::pco/op-name      a
 *                                 ::node-id          1
 *                                 ::requires         {:a {}}
 *                                 ::input            {}
 *                                 ::source-for-attrs #{:a}
 *                                 ::node-parents      #{3}}
 *                              2 {::pco/op-name      b
 *                                 ::node-id          2
 *                                 ::requires         {:b {}}
 *                                 ::input            {}
 *                                 ::source-for-attrs #{:b}
 *                                 ::node-parents      #{3}}
 *                              3 {::node-id  3
 *                                 ::requires {:b {} :a {} :c {}}
 *                                 ::run-and  #{2 1 4}}
 *                              4 {::pco/op-name      c
 *                                 ::node-id          4
 *                                 ::requires         {:c {}}
 *                                 ::input            {}
 *                                 ::source-for-attrs #{:c}
 *                                 ::node-parents      #{3}}}
 *     ::index-resolver->nodes {a #{1} b #{2} c #{4}}
 *     ::unreachable-attrs     #{}
 *     ::index-attrs           {:a #{1} :b #{2} :c #{4}}
 *     ::root                  3}
 *   
 */
com.wsscode.pathom3.connect.planner.compute_run_graph = (function com$wsscode$pathom3$connect$planner$compute_run_graph(var_args){
var G__158413 = arguments.length;
switch (G__158413) {
case 1:
return com.wsscode.pathom3.connect.planner.compute_run_graph.cljs$core$IFn$_invoke$arity$1((arguments[(0)]));

break;
case 2:
return com.wsscode.pathom3.connect.planner.compute_run_graph.cljs$core$IFn$_invoke$arity$2((arguments[(0)]),(arguments[(1)]));

break;
default:
throw (new Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join('')));

}
});

(com.wsscode.pathom3.connect.planner.compute_run_graph.cljs$core$IFn$_invoke$arity$1 = (function (env){
return com.wsscode.pathom3.connect.planner.compute_run_graph.cljs$core$IFn$_invoke$arity$2(cljs.core.PersistentArrayMap.EMPTY,env);
}));

(com.wsscode.pathom3.connect.planner.compute_run_graph.cljs$core$IFn$_invoke$arity$2 = (function (graph,p__158414){
var map__158415 = p__158414;
var map__158415__$1 = cljs.core.__destructure_map(map__158415);
var env = map__158415__$1;
var optimize_graph_QMARK_ = cljs.core.get.cljs$core$IFn$_invoke$arity$3(map__158415__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","optimize-graph?","com.wsscode.pathom3.connect.planner/optimize-graph?",95148922),true);
com.wsscode.pathom3.connect.planner.add_snapshot_BANG_(graph,env,new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-event","com.wsscode.pathom3.connect.planner/snapshot-event",-122347979),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-start-graph","com.wsscode.pathom3.connect.planner/snapshot-start-graph",-1423570127),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),"Start query plan"], null));

return com.wsscode.pathom3.cache.cached(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","plan-cache*","com.wsscode.pathom3.connect.planner/plan-cache*",-982885642),env,new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.hash(new cljs.core.Keyword("com.wsscode.pathom3.connect.indexes","index-oir","com.wsscode.pathom3.connect.indexes/index-oir",-418434909).cljs$core$IFn$_invoke$arity$1(env)),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","available-data","com.wsscode.pathom3.connect.planner/available-data",727921292).cljs$core$IFn$_invoke$arity$1(env),new cljs.core.Keyword("edn-query-language.ast","node","edn-query-language.ast/node",-1614840957).cljs$core$IFn$_invoke$arity$1(env)], null),(function (){
var env_SINGLEQUOTE_ = cljs.core.vary_meta.cljs$core$IFn$_invoke$arity$4(cljs.core.merge.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([com.wsscode.pathom3.connect.planner.base_env(),env], 0)),cljs.core.assoc,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","original-env","com.wsscode.pathom3.connect.planner/original-env",-154232736),env);
var G__158416 = com.wsscode.pathom3.connect.planner.compute_run_graph_STAR_(cljs.core.merge.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([com.wsscode.pathom3.connect.planner.base_graph(),graph,new cljs.core.PersistentArrayMap(null, 3, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","index-ast","com.wsscode.pathom3.connect.planner/index-ast",905845713),com.wsscode.pathom3.format.eql.index_ast(new cljs.core.Keyword("edn-query-language.ast","node","edn-query-language.ast/node",-1614840957).cljs$core$IFn$_invoke$arity$1(env)),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","source-ast","com.wsscode.pathom3.connect.planner/source-ast",1604047106),new cljs.core.Keyword("edn-query-language.ast","node","edn-query-language.ast/node",-1614840957).cljs$core$IFn$_invoke$arity$1(env),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","available-data","com.wsscode.pathom3.connect.planner/available-data",727921292),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","available-data","com.wsscode.pathom3.connect.planner/available-data",727921292).cljs$core$IFn$_invoke$arity$1(env)], null)], 0)),env_SINGLEQUOTE_);
if(cljs.core.truth_(optimize_graph_QMARK_)){
return (com.wsscode.pathom3.connect.planner.optimize_graph.cljs$core$IFn$_invoke$arity$2 ? com.wsscode.pathom3.connect.planner.optimize_graph.cljs$core$IFn$_invoke$arity$2(G__158416,env_SINGLEQUOTE_) : com.wsscode.pathom3.connect.planner.optimize_graph.call(null,G__158416,env_SINGLEQUOTE_));
} else {
return G__158416;
}
}));
}));

(com.wsscode.pathom3.connect.planner.compute_run_graph.cljs$lang$maxFixedArity = 2);

com.wsscode.pathom3.connect.planner.can_merge_sibling_resolver_nodes_QMARK_ = (function com$wsscode$pathom3$connect$planner$can_merge_sibling_resolver_nodes_QMARK_(graph,node_id1,node_id2){
var n1 = com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,node_id1);
var n2 = com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,node_id2);
var and__4221__auto__ = new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049).cljs$core$IFn$_invoke$arity$1(n1);
if(cljs.core.truth_(and__4221__auto__)){
return cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049).cljs$core$IFn$_invoke$arity$1(n1),new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049).cljs$core$IFn$_invoke$arity$1(n2));
} else {
return and__4221__auto__;
}
});
com.wsscode.pathom3.connect.planner.optimize_AND_resolver_siblings = (function com$wsscode$pathom3$connect$planner$optimize_AND_resolver_siblings(graph,env,parent_id,pivot,other_nodes){
var matching_nodes = cljs.core.into.cljs$core$IFn$_invoke$arity$3(cljs.core.PersistentHashSet.EMPTY,cljs.core.filter.cljs$core$IFn$_invoke$arity$1((function (p1__158417_SHARP_){
return com.wsscode.pathom3.connect.planner.can_merge_sibling_resolver_nodes_QMARK_(graph,pivot,p1__158417_SHARP_);
})),other_nodes);
var merge_nodes = cljs.core.sort.cljs$core$IFn$_invoke$arity$1(cljs.core.conj.cljs$core$IFn$_invoke$arity$2(matching_nodes,pivot));
var graph_SINGLEQUOTE_ = (function (){var G__158418 = graph;
if(cljs.core.seq(matching_nodes)){
return com.wsscode.pathom3.connect.planner.merge_sibling_resolver_nodes(G__158418,env,parent_id,merge_nodes);
} else {
return G__158418;
}
})();
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [(function (){var G__158419 = graph_SINGLEQUOTE_;
var G__158420 = env;
var G__158421 = cljs.core.first(merge_nodes);
return (com.wsscode.pathom3.connect.planner.optimize_node.cljs$core$IFn$_invoke$arity$3 ? com.wsscode.pathom3.connect.planner.optimize_node.cljs$core$IFn$_invoke$arity$3(G__158419,G__158420,G__158421) : com.wsscode.pathom3.connect.planner.optimize_node.call(null,G__158419,G__158420,G__158421));
})(),cljs.core.into.cljs$core$IFn$_invoke$arity$3(cljs.core.PersistentHashSet.EMPTY,cljs.core.remove.cljs$core$IFn$_invoke$arity$1(matching_nodes),other_nodes)], null);
});
/**
 * This pass will collapse the same resolver node branches. This also do a local optimization
 *   on AND's and OR's sub-nodes. This is important to simplify the pass to merge OR nodes.
 */
com.wsscode.pathom3.connect.planner.optimize_AND_resolvers_pass = (function com$wsscode$pathom3$connect$planner$optimize_AND_resolvers_pass(graph,env,sibling_ids,parent_id){
var graph__$1 = graph;
var G__158425 = sibling_ids;
var vec__158426 = G__158425;
var seq__158427 = cljs.core.seq(vec__158426);
var first__158428 = cljs.core.first(seq__158427);
var seq__158427__$1 = cljs.core.next(seq__158427);
var pivot = first__158428;
var node_ids = seq__158427__$1;
var graph__$2 = graph__$1;
var G__158425__$1 = G__158425;
while(true){
var graph__$3 = graph__$2;
var vec__158429 = G__158425__$1;
var seq__158430 = cljs.core.seq(vec__158429);
var first__158431 = cljs.core.first(seq__158430);
var seq__158430__$1 = cljs.core.next(seq__158430);
var pivot__$1 = first__158431;
var node_ids__$1 = seq__158430__$1;
if(cljs.core.truth_(pivot__$1)){
if(cljs.core.truth_(com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$3(graph__$3,pivot__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.operation","op-name","com.wsscode.pathom3.connect.operation/op-name",-1249801049)))){
var vec__158432 = com.wsscode.pathom3.connect.planner.optimize_AND_resolver_siblings(graph__$3,env,parent_id,pivot__$1,node_ids__$1);
var graph_SINGLEQUOTE_ = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158432,(0),null);
var node_ids_SINGLEQUOTE_ = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__158432,(1),null);
var G__158564 = graph_SINGLEQUOTE_;
var G__158565 = node_ids_SINGLEQUOTE_;
graph__$2 = G__158564;
G__158425__$1 = G__158565;
continue;
} else {
var G__158566 = (com.wsscode.pathom3.connect.planner.optimize_node.cljs$core$IFn$_invoke$arity$3 ? com.wsscode.pathom3.connect.planner.optimize_node.cljs$core$IFn$_invoke$arity$3(graph__$3,env,pivot__$1) : com.wsscode.pathom3.connect.planner.optimize_node.call(null,graph__$3,env,pivot__$1));
var G__158567 = node_ids__$1;
graph__$2 = G__158566;
G__158425__$1 = G__158567;
continue;

}
} else {
return graph__$3;
}
break;
}
});
com.wsscode.pathom3.connect.planner.optimize_AND_ORs = (function com$wsscode$pathom3$connect$planner$optimize_AND_ORs(graph,_env,sibling_ids,_parent_id){
var or_nodes = cljs.core.into.cljs$core$IFn$_invoke$arity$3(cljs.core.PersistentVector.EMPTY,cljs.core.keep.cljs$core$IFn$_invoke$arity$1((function (p1__158435_SHARP_){
var node = com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,p1__158435_SHARP_);
if(cljs.core.truth_(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-or","com.wsscode.pathom3.connect.planner/run-or",-672801891).cljs$core$IFn$_invoke$arity$1(node))){
return node;
} else {
return null;
}
})),sibling_ids);
if((cljs.core.count(or_nodes) > (1))){
var graph__$1 = graph;
var G__158439 = or_nodes;
var vec__158440 = G__158439;
var seq__158441 = cljs.core.seq(vec__158440);
var first__158442 = cljs.core.first(seq__158441);
var seq__158441__$1 = cljs.core.next(seq__158441);
var pivot = first__158442;
var other_nodes = seq__158441__$1;
var graph__$2 = graph__$1;
var G__158439__$1 = G__158439;
while(true){
var graph__$3 = graph__$2;
var vec__158443 = G__158439__$1;
var seq__158444 = cljs.core.seq(vec__158443);
var first__158445 = cljs.core.first(seq__158444);
var seq__158444__$1 = cljs.core.next(seq__158444);
var pivot__$1 = first__158445;
var other_nodes__$1 = seq__158444__$1;
return cljs.core.reduce.cljs$core$IFn$_invoke$arity$3(((function (graph__$3,vec__158443,seq__158444,first__158445,seq__158444__$1,pivot__$1,other_nodes__$1,graph__$1,G__158439,vec__158440,seq__158441,first__158442,seq__158441__$1,pivot,other_nodes,or_nodes){
return (function (graph__$4,or_node){
if(cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(cljs.core.count(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-or","com.wsscode.pathom3.connect.planner/run-or",-672801891).cljs$core$IFn$_invoke$arity$1(pivot__$1)),cljs.core.count(new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-or","com.wsscode.pathom3.connect.planner/run-or",-672801891).cljs$core$IFn$_invoke$arity$1(or_node)))){
return graph__$4;
} else {
return graph__$4;
}
});})(graph__$3,vec__158443,seq__158444,first__158445,seq__158444__$1,pivot__$1,other_nodes__$1,graph__$1,G__158439,vec__158440,seq__158441,first__158442,seq__158441__$1,pivot,other_nodes,or_nodes))
,graph__$3,other_nodes__$1);
break;
}
} else {
return graph;
}
});
com.wsscode.pathom3.connect.planner.optimize_AND_branches = (function com$wsscode$pathom3$connect$planner$optimize_AND_branches(graph,env,node_id){
var map__158446 = com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,node_id);
var map__158446__$1 = cljs.core.__destructure_map(map__158446);
var run_and = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158446__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-and","com.wsscode.pathom3.connect.planner/run-and",-1356844884));
return com.wsscode.pathom3.connect.planner.simplify_branch_node(com.wsscode.pathom3.connect.planner.optimize_AND_resolvers_pass(graph,env,run_and,node_id),env,node_id);
});
com.wsscode.pathom3.connect.planner.optimize_OR_branches = (function com$wsscode$pathom3$connect$planner$optimize_OR_branches(graph,env,node_id){
var map__158447 = com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,node_id);
var map__158447__$1 = cljs.core.__destructure_map(map__158447);
var run_or = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__158447__$1,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-or","com.wsscode.pathom3.connect.planner/run-or",-672801891));
return cljs.core.reduce.cljs$core$IFn$_invoke$arity$3((function (graph__$1,node_id__$1){
return (com.wsscode.pathom3.connect.planner.optimize_node.cljs$core$IFn$_invoke$arity$3 ? com.wsscode.pathom3.connect.planner.optimize_node.cljs$core$IFn$_invoke$arity$3(graph__$1,env,node_id__$1) : com.wsscode.pathom3.connect.planner.optimize_node.call(null,graph__$1,env,node_id__$1));
}),graph,run_or);
});
com.wsscode.pathom3.connect.planner.optimize_node = (function com$wsscode$pathom3$connect$planner$optimize_node(graph,env,node_id){
while(true){
var temp__5751__auto__ = com.wsscode.pathom3.connect.planner.get_node.cljs$core$IFn$_invoke$arity$2(graph,node_id);
if(cljs.core.truth_(temp__5751__auto__)){
var node = temp__5751__auto__;
com.wsscode.pathom3.connect.planner.add_snapshot_BANG_(graph,env,new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),["Visit node ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(node_id)].join(''),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","highlight-nodes","com.wsscode.pathom3.connect.planner/highlight-nodes",-1697917026),cljs.core.PersistentHashSet.createAsIfByAssoc([node_id])], null));

var G__158574 = (function (){var G__158448 = com.wsscode.pathom3.connect.planner.node_kind(node);
var G__158448__$1 = (((G__158448 instanceof cljs.core.Keyword))?G__158448.fqn:null);
switch (G__158448__$1) {
case "com.wsscode.pathom3.connect.planner/node-resolver":
return graph;

break;
case "com.wsscode.pathom3.connect.planner/node-and":
return com.wsscode.pathom3.connect.planner.optimize_AND_branches(graph,env,node_id);

break;
case "com.wsscode.pathom3.connect.planner/node-or":
return com.wsscode.pathom3.connect.planner.optimize_OR_branches(graph,env,node_id);

break;
default:
throw (new Error(["No matching clause: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(G__158448__$1)].join('')));

}
})();
var G__158575 = env;
var G__158576 = new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","run-next","com.wsscode.pathom3.connect.planner/run-next",285457140).cljs$core$IFn$_invoke$arity$1(node);
graph = G__158574;
env = G__158575;
node_id = G__158576;
continue;
} else {
return graph;
}
break;
}
});
com.wsscode.pathom3.connect.planner.optimize_graph = (function com$wsscode$pathom3$connect$planner$optimize_graph(graph,env){
return com.wsscode.pathom3.connect.planner.optimize_node(com.wsscode.pathom3.connect.planner.add_snapshot_BANG_(graph,env,new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),"=== Optimize ==="], null)),env,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","root","com.wsscode.pathom3.connect.planner/root",311111212).cljs$core$IFn$_invoke$arity$1(graph));
});
com.wsscode.pathom3.connect.planner.with_plan_cache = (function com$wsscode$pathom3$connect$planner$with_plan_cache(var_args){
var G__158450 = arguments.length;
switch (G__158450) {
case 1:
return com.wsscode.pathom3.connect.planner.with_plan_cache.cljs$core$IFn$_invoke$arity$1((arguments[(0)]));

break;
case 2:
return com.wsscode.pathom3.connect.planner.with_plan_cache.cljs$core$IFn$_invoke$arity$2((arguments[(0)]),(arguments[(1)]));

break;
default:
throw (new Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join('')));

}
});

(com.wsscode.pathom3.connect.planner.with_plan_cache.cljs$core$IFn$_invoke$arity$1 = (function (env){
return com.wsscode.pathom3.connect.planner.with_plan_cache.cljs$core$IFn$_invoke$arity$2(env,cljs.core.atom.cljs$core$IFn$_invoke$arity$1(cljs.core.PersistentArrayMap.EMPTY));
}));

(com.wsscode.pathom3.connect.planner.with_plan_cache.cljs$core$IFn$_invoke$arity$2 = (function (env,cache_STAR_){
return cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(env,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","plan-cache*","com.wsscode.pathom3.connect.planner/plan-cache*",-982885642),cache_STAR_);
}));

(com.wsscode.pathom3.connect.planner.with_plan_cache.cljs$lang$maxFixedArity = 2);

/**
 * Run compute graph capturing snapshots, return the snapshots vector in the end.
 */
com.wsscode.pathom3.connect.planner.compute_plan_snapshots = (function com$wsscode$pathom3$connect$planner$compute_plan_snapshots(env){
var snapshots_STAR_ = cljs.core.atom.cljs$core$IFn$_invoke$arity$1(cljs.core.PersistentVector.EMPTY);
var graph = (function (){try{return com.wsscode.pathom3.connect.planner.compute_run_graph.cljs$core$IFn$_invoke$arity$1(cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(env,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","plan-cache*","com.wsscode.pathom3.connect.planner/plan-cache*",-982885642)),new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshots*","com.wsscode.pathom3.connect.planner/snapshots*",-1855095128),snapshots_STAR_));
}catch (e158451){var e = e158451;
return new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),["Planning stopped due to an error: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.ex_message(e))].join(''),new cljs.core.Keyword(null,"error","error",-978969032),e], null);
}})();
return cljs.core.conj.cljs$core$IFn$_invoke$arity$2(cljs.core.deref(snapshots_STAR_),cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(graph,new cljs.core.Keyword("com.wsscode.pathom3.connect.planner","snapshot-message","com.wsscode.pathom3.connect.planner/snapshot-message",1408384173),"Complete graph."));
});

//# sourceMappingURL=com.wsscode.pathom3.connect.planner.js.map
