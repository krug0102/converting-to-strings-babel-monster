{"version":3,"sources":["com/wsscode/pathom3/entity_tree.cljc"],"mappings":"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","names":["cljs.spec.alpha/def-impl","cljs.core/map?","com.wsscode.misc.refs/atom?","p__82056","map__82057","cljs.core/--destructure-map","cljs.core.get","com.wsscode.pathom3.entity-tree/entity","entity-tree*","G__82058","cljs.core/deref","com.wsscode.pathom3.entity-tree/create-entity","x","cljs.core.atom","com.wsscode.pathom3.entity-tree/with-entity","env","entity-tree","cljs.core.assoc","p__82062","map__82063","com.wsscode.pathom3.entity-tree/reset-entity!","cljs.core/reset!","var_args","G__82073","com.wsscode.pathom3.entity-tree/swap-entity!","args-arr__4850__auto__","len__4829__auto__","i__4830__auto__","argseq__4851__auto__","cljs.core/IndexedSeq","p__82074","map__82076","p__82079","map__82080","p__82081","map__82082","p__82083","map__82084","seq82067","G__82069","cljs.core/first","cljs.core/next","G__82070","G__82071","G__82072","self__4816__auto__","f","cljs.core.swap_BANG_","y","args","cljs.core.apply","cljs.core/swap!","G__82092","com.wsscode.pathom3.entity-tree/vswap-entity!","p__82093","map__82094","p__82096","map__82097","p__82100","map__82101","p__82105","map__82107","seq82087","G__82088","G__82089","G__82090","G__82091","cljs.core/-vreset!","G__82095","cljs.core/-deref","G__82098","G__82099","G__82102","G__82103","G__82104","cljs.core/vreset!","com.wsscode.pathom3.entity-tree/merge-entity-data","entity","new-data","cljs.core/reduce-kv","cljs.core/assoc"],"sourcesContent":["(ns com.wsscode.pathom3.entity-tree\n  (:require\n    [clojure.spec.alpha :as s]\n    [com.fulcrologic.guardrails.core :refer [<- => >def >defn >fdef ? |]]\n    [com.wsscode.misc.refs :as refs]))\n\n(>def ::entity-tree map?)\n(>def ::entity-tree* refs/atom?)\n\n(>defn entity\n  \"Returns the entity tree value from env\"\n  [{::keys [entity-tree*]}]\n  [(s/keys :opt [::entity-tree*]) => (? map?)]\n  (some-> entity-tree* deref))\n\n(>defn create-entity [x]\n  [::entity-tree => ::entity-tree*]\n  (atom x))\n\n(>defn with-entity\n  \"Set the entity in the environment. Note in this function you must send the cache-tree\n  as a map, not as an atom.\"\n  [env entity-tree]\n  [map? map? => map?]\n  (assoc env ::entity-tree* (atom entity-tree)))\n\n(>defn reset-entity!\n  [{::keys [entity-tree*]} entity-tree]\n  [(s/keys :req [::entity-tree*]) ::entity-tree => ::entity-tree]\n  (reset! entity-tree* entity-tree))\n\n(>defn swap-entity!\n  \"Swap cache-tree at the current path. Returns the updated whole cache-tree.\"\n  ([{::keys [entity-tree*]} f]\n   [(s/keys :req [::entity-tree*]) fn?\n    => map?]\n   (swap! entity-tree* f))\n  ([{::keys [entity-tree*]} f x]\n   [(s/keys :req [::entity-tree*]) fn? any?\n    => map?]\n   (swap! entity-tree* f x))\n  ([{::keys [entity-tree*]} f x y]\n   [(s/keys :req [::entity-tree*]) fn? any? any?\n    => map?]\n   (swap! entity-tree* f x y))\n  ([{::keys [entity-tree*]} f x y & args]\n   [(s/keys :req [::entity-tree*]) fn? any? any? (s/+ any?)\n    => map?]\n   (apply swap! entity-tree* f x y args)))\n\n(>defn vswap-entity!\n  \"Swap cache-tree at the current path. Returns the updated whole cache-tree.\"\n  ([{::keys [entity-tree*]} f]\n   [(s/keys :req [::entity-tree*]) fn?\n    => map?]\n   (vswap! entity-tree* f))\n  ([{::keys [entity-tree*]} f x]\n   [(s/keys :req [::entity-tree*]) fn? any?\n    => map?]\n   (vswap! entity-tree* f x))\n  ([{::keys [entity-tree*]} f x y]\n   [(s/keys :req [::entity-tree*]) fn? any? any?\n    => map?]\n   (vswap! entity-tree* f x y))\n  ([{::keys [entity-tree*]} f x y & args]\n   [(s/keys :req [::entity-tree*]) fn? any? any? (s/+ any?)\n    => map?]\n   (vreset! entity-tree* (apply f @entity-tree* x y args))))\n\n(>defn merge-entity-data\n  \"Specialized merge versions that work on entity data.\"\n  [entity new-data]\n  [::entity-tree ::entity-tree => ::entity-tree]\n  (reduce-kv\n    assoc\n    entity\n    new-data))\n"]}