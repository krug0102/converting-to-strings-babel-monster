{"version":3,"sources":["sci/impl/interop.cljc"],"mappings":"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","names":["sci.impl.interop/toJS","v","cljs.core/MetaFn","cljs.core/clj->js","sci.impl.interop/js-object-array","args","cljs.core/to-array","cljs.core.map","sci.impl.interop/invoke-instance-method","obj","_target-class","method-name","cljs.core.subs","temp__5751__auto__","method","js/Error","p__69334","vec__69336","cljs.core.nth","sci.impl.interop/get-static-field","class","field-name-sym","goog.object/get","sci.impl.interop/invoke-js-constructor","constructor","ctor","js/Function.prototype.bind.apply","G__69371","cljs.core.ex_info","sci.impl.interop/invoke-constructor","p__69379","vec__69380","sci.impl.interop/invoke-static-method","vec__69383","field","sub-method-name","clojure.string.split","clojure.string/ends-with?","p__69390","map__69392","cljs.core/--destructure-map","env","cljs.core.get","class->opts","sci.impl.interop/fully-qualify-class","sym","or__4223__auto__","ns*","cljs.core/namespace","cljs.core/contains?","cljs.core.symbol","cljs.core/name","cljs.core/deref","cnn","sci.impl.vars/current-ns-name","cljs.core.get_in","p__69399","map__69400","sci.impl.interop/resolve-class-opts","class-opts","temp__5753__auto__","sci.impl.interop/resolve-class","ctx"],"sourcesContent":["(ns sci.impl.interop\n  {:no-doc true}\n  #?(:clj (:import [sci.impl Reflector]))\n  (:require #?(:cljs [goog.object :as gobj])\n            [sci.impl.vars :as vars]\n            #?(:cljs [clojure.string])))\n\n;; see https://github.com/clojure/clojure/blob/master/src/jvm/clojure/lang/Reflector.java\n;; see invokeStaticMethod, getStaticField, etc.\n\n#?(:clj (set! *warn-on-reflection* true))\n\n\n#?(:cljs\n   (do\n     (defn toJS [v]\n       (if (instance? MetaFn v)\n         ;; when returning a function, make it callable from JS\n         (.-afn v)\n         (clj->js v)))\n\n     (defn js-object-array [args]\n       (to-array (map toJS args)))))\n\n(defn invoke-instance-method\n  #?@(:cljs [[obj _target-class method-name args]\n             ;; gobj/get didn't work here\n             (if (identical? \\- (.charAt method-name 0))\n               (aget obj (subs method-name 1))\n               (if-let [method (aget obj method-name)]\n                 (.apply method obj (js-object-array args))\n                 (throw (js/Error. (str \"Could not find instance method: \" method-name)))))]\n      :clj\n      [#_([obj method args]\n        (invoke-instance-method obj nil method args))\n       ([obj target-class method args]\n        (if-not target-class\n          (Reflector/invokeInstanceMethod obj method (object-array args))\n          (let [methods (Reflector/getMethods target-class (count args) method false)]\n            (Reflector/invokeMatchingMethod method methods obj (object-array args)))))]))\n\n(defn get-static-field #?(:clj [[^Class class field-name-sym]]\n                          :cljs [[class field-name-sym]])\n  #?(:clj (Reflector/getStaticField class (str field-name-sym))\n     :cljs (gobj/get class field-name-sym)))\n\n#?(:cljs\n   (defn invoke-js-constructor [constructor args]\n     (let [ctor (js/Function.prototype.bind.apply constructor)\n           args (js-object-array args)]\n       (case (count args)\n         0 (new ctor)\n         1 (new ctor (nth args 0))\n         2 (new ctor (nth args 0) (nth args 1))\n         3 (new ctor (nth args 0) (nth args 1) (nth args 2))\n         4 (new ctor (nth args 0) (nth args 1) (nth args 2) (nth args 3))\n         5 (new ctor (nth args 0) (nth args 1) (nth args 2) (nth args 3) (nth args 4))\n         6 (new ctor (nth args 0) (nth args 1) (nth args 2) (nth args 3) (nth args 4) (nth args 5))\n         7 (new ctor (nth args 0) (nth args 1) (nth args 2) (nth args 3) (nth args 4) (nth args 5) (nth args 6))\n\n         (throw (ex-info \"Constructors with more than 7 arguments are not supported\" {:constructor constructor}))))))\n\n(defn invoke-constructor #?(:clj [^Class class args]\n                            :cljs [constructor args])\n  #?(:clj (Reflector/invokeConstructor class (object-array args))\n     :cljs (invoke-js-constructor constructor args)))\n\n(defn invoke-static-method #?(:clj [[^Class class method-name] args]\n                              :cljs [[class method-name] args])\n  #?(:clj\n     (Reflector/invokeStaticMethod class (str method-name) (object-array args))\n     :cljs (if-let [method (gobj/get class method-name)]\n             (.apply method class (js-object-array args))\n             (let [method-name (str method-name)\n                   [field sub-method-name] (clojure.string/split method-name #\"\\.\")]\n               (cond\n                 sub-method-name\n                 (invoke-instance-method (get-static-field [class field]) nil sub-method-name args)\n\n                 (clojure.string/ends-with? method-name \".\")\n                 (invoke-js-constructor (get-static-field [class field]) args)\n\n                 :else\n                 (throw (js/Error. (str \"Could not find static method \" method-name))))))))\n\n(defn fully-qualify-class [{:keys [:env :class->opts]} sym]\n  (or #?(:clj (when (contains? class->opts sym) sym)\n         :cljs (if-let [ns* (namespace sym)]\n                 (when (identical? \"js\" ns*)\n                   (when (contains? class->opts (symbol (name sym)))\n                     sym))\n                 (when (contains? class->opts sym)\n                   sym)))\n      (let [env @env]\n        (or (get (:imports env) sym)\n            (let [cnn (vars/current-ns-name)]\n              (get-in env [:namespaces cnn :imports sym]))))))\n\n(defn resolve-class-opts [{:keys [:env :class->opts]} sym]\n  (let [class-opts (or #?(:clj (get class->opts sym)\n                     :cljs (if-let [ns* (namespace sym)]\n                             (when (identical? \"js\" ns*)\n                               (get class->opts (symbol (name sym))))\n                             (get class->opts sym)))\n                       (let [env @env]\n                         (or\n                          (when-let [v (get-in env [:imports sym])]\n                            (get class->opts v))\n                          (let [cnn (vars/current-ns-name)]\n                            (when-let [v (get-in env [:namespaces cnn :imports sym])]\n                              (get class->opts v))))))]\n    class-opts))\n\n(defn resolve-class [ctx sym]\n  (:class (resolve-class-opts ctx sym)))\n"]}