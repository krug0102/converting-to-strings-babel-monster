{"version":3,"sources":["repl_tooling/editor_integration/stacktraces_test.cljs"],"mappings":"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","names":["repl-tooling.editor-integration.stacktraces-test/click-link","link-text","promesa.protocols/-bind","___31820__auto__","___31810__auto__","promesa.protocols/-promise","find-link","js/document","cljs.core/rest","p1__107278#","cljs.core.filter","cljs.core/re-find","cljs.core/re-pattern","cljs.core/first","link","repl-tooling.integration.fake-editor/wait-for-p","repl-tooling.editor-integration.stacktraces-test/open-editor-callback","last-call","cljs.core.atom","promesa.core/deferred","cljs.core/deref","prom","promesa.core.then","cljs.core/reset!","res","promesa.core.resolve_BANG_","devcards.core/register-card","devcards.core/card-base","devcards.core.test_card","cljs.test/test-var","repl-tooling.editor-integration.stacktraces-test/clickable-stacktraces","map__107303","cljs.core/--destructure-map","cljs.core.get","map__107362","opened-editor","callback","check.async/async-test*","___31809__auto__","repl-tooling.integration.fake-editor/disconnect!","repl_tooling.integration.fake_editor.connect_BANG_","promesa.core.finally$","cljs.test.update_current_env_BANG_","cljs.core/conj","___36014__auto__","cljs.test/update-current-env!","cljs.core.swap_BANG_","repl-tooling.integration.fake-editor/state","cljs.core/assoc","repl-tooling.integration.fake-editor/type-and-eval","check.async/to-promise","left-107336","right-107337","cljs.test/do-report","cljs.core.assoc","lft__35783__auto__","rgt__35784__auto__","qleft__35785__auto__","qright__35786__auto__","result__35787__auto__","matcher-combinators.core/match","msg__35788__auto__","cljs.core.pr_str","matcher-combinators.printer/as-string","pass?__35789__auto__","cljs.core._EQ_","cljs.core.symbol","left-107375","right-107376","left-107348","right-107349","left-107392","right-107393","js/repl-tooling","js/repl-tooling.editor-integration","js/repl-tooling.editor-integration.stacktraces-test","js/repl-tooling.editor-integration.stacktraces-test.t_repl_tooling$editor_integration$stacktraces_test107400","repl-tooling.editor-integration.stacktraces-test/t_repl_tooling$editor_integration$stacktraces_test107400","_107402","meta107401","cljs.core/PROTOCOL_SENTINEL","this__54113__auto__","devcard-opts__54114__auto__","v__54138__auto__","cljs.core/fn?","data-atom__54139__auto__","owner__54140__auto__","reagent.core/as-element","cljs.core.merge","devcards.core/assert-options-map","this__4461__auto__","writer__4462__auto__","opt__4463__auto__","cljs.core/-write","repl-tooling.editor-integration.stacktraces-test/->t_repl_tooling$editor_integration$stacktraces_test107400","repl-tooling.integration.fake-editor/editor"],"sourcesContent":["(ns repl-tooling.editor-integration.stacktraces-test\n  (:require [devcards.core :as cards :include-macros true]\n            [clojure.test]\n            [promesa.core :as p]\n            [repl-tooling.integration.fake-editor :as fake]\n            [check.async :refer [async-test check testing]]))\n\n(defn- click-link [link-text]\n  (p/let [find-link\n          (fn []\n            (->> \"div.result a\"\n                 (.querySelectorAll js/document)\n                 rest\n                 (filter #(->> % .-innerText (re-find (re-pattern link-text))))\n                 first))\n\n          link (fake/wait-for-p find-link)]\n    (.click link)))\n\n(defn open-editor-callback []\n  (let [last-call (atom (p/deferred))]\n    {:opened-editor (fn [] (let [prom @last-call]\n                             (p/then prom #(reset! last-call (p/deferred)))\n                             prom))\n     :callback (fn [res]\n                 (p/resolve! @last-call res))}))\n\n(cards/deftest clickable-stacktraces\n  (let [{:keys [opened-editor callback]} (open-editor-callback)]\n    (async-test \"pathom resolvers\" {:teardown (fake/disconnect!)\n                                    :timeout 8000}\n      (fake/connect! {:open-editor callback})\n\n      (testing \"will open a Clojure code from a stacktrace derived from classpath\"\n        (swap! fake/state assoc :filename \"test/repl_tooling/integration/fake_editor.clj\")\n        (fake/type-and-eval \"(/ 10 0)\")\n        (click-link \"fake_editor.clj:1\")\n        (check (opened-editor)\n               => {:file-name \"test/repl_tooling/integration/fake_editor.clj\"\n                   :line 0}))\n\n      (testing \"will open a Clojure source code inside a JAR\"\n        (click-link \"core.clj\")\n        (check (opened-editor)\n               => {:file-name #\"clojure.*jar!.*core.clj\"\n                   :contents #\"clojure.core\"}))\n\n      ; FIXME: Stacktraces are not working on Electron. Don't know why\n      #_\n      (testing \"will parse source maps for ClojureScript\"\n        (fake/run-command! :connect-embedded)\n        (p/delay 200)\n        (swap! fake/state assoc :filename \"foo.cljs\")\n        (fake/type-and-eval \"(repl-tooling.integration.fixture-app/some-replace :what)\")\n        (click-link \"fixture_app.cljs\")\n        (check (opened-editor)\n               => {:file-name #\"test/repl_tooling/integration/fixture_app\\.cljs\"})))))\n\n(cards/defcard-rg fake-editor\n  fake/editor\n  fake/state)\n"]}